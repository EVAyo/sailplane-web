var liner=function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var u=e[a](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function u(e){i(o,n,a,u,s,"next",e)}function s(e){i(o,n,a,u,s,"throw",e)}u(void 0)}))}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,r){return(g=y()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&p(i,r.prototype),i}).apply(null,arguments)}function m(e){var t="function"==typeof Map?new Map:void 0;return(m=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return g(e,arguments,v(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),p(n,e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function w(e){var t=y();return function(){var r,n=v(e);if(t){var i=v(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return k(this,r)}}function b(e,t,r){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function B(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=A(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}var C={};"undefined"!=typeof self&&(C=self),e.nativeCrypto=C.msCrypto||C.crypto||{},e.nativeSubtle=null;try{e.nativeSubtle=(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.subtle)||(null===e.nativeCrypto||void 0===e.nativeCrypto?void 0:e.nativeCrypto.webkitSubtle)||null}catch(e){console.warn("Cannot get subtle from crypto",e)}function R(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new Uint8Array(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var N=function(){function e(){o(this,e)}return s(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=R(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=R(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(e){return e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob?this.FromBinary(atob(e)):new Uint8Array(Buffer.from(e,"base64")).buffer}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"ToUtf8String",value:function(e){var t=R(e),r=String.fromCharCode.apply(null,t);return decodeURIComponent(escape(r))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=R(e),r="",n=t.length,i=0;i<n;i++)r+=String.fromCharCode(t[i]);return r}},{key:"ToHex",value:function(e){for(var t=R(e),r=[],n=t.length,i=0;i<n;i++){var a=t[i].toString(16);r.push(1===a.length?"0"+a:a)}return r.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var n=e.slice(r,r+2);t[r/2]=parseInt(n,16)}return t.buffer}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),E=function(){function e(){o(this,e)}return s(e,null,[{key:"toArrayBuffer",value:function(e){var t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}},{key:"toUint8Array",value:function(e){if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e&&e.buffer instanceof ArrayBuffer}}]),e}();function K(e,t,r,i){var a,o=arguments.length,u=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"===("undefined"==typeof Reflect?"undefined":n(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(u=(o<3?a(u):o>3?a(t,r,u):a(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u}function O(e,t){return e(t={exports:{}},t.exports),t.exports}function U(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function L(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=r,i=e,a=0,o=Math.pow(2,t),u=1;u<8;u++){if(e<o){var s=void 0;if(n<0)s=new ArrayBuffer(u),a=u;else{if(n<u)return new ArrayBuffer(0);s=new ArrayBuffer(n),a=n}for(var c=new Uint8Array(s),l=u-1;l>=0;l--){var h=Math.pow(2,l*t);c[a-l-1]=Math.floor(i/h),i-=c[a-l-1]*h}return s}o*=Math.pow(2,t)}return new ArrayBuffer(0)}var H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";var I=Math.log(2);var T,D,j,_=Object.freeze({__proto__:null,getUTCDate:function(e){return new Date(e.getTime()+6e4*e.getTimezoneOffset())},getParametersValue:function(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r},bufferToHexCodes:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="",o=x(new Uint8Array(e,r,n));try{for(o.s();!(t=o.n()).done;){var u=t.value,s=u.toString(16).toUpperCase();1===s.length&&(a+="0"),a+=s,i&&(a+=" ")}}catch(e){o.e(e)}finally{o.f()}return a.trim()},checkBufferParams:function(e,t,r,n){return t instanceof ArrayBuffer==!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)},utilFromBase:U,utilToBase:L,utilConcatBuf:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){var u=o[a];e+=u.byteLength}for(var s=new ArrayBuffer(e),c=new Uint8Array(s),l=0,h=n;l<h.length;l++){var f=h[l];c.set(new Uint8Array(f),t),t+=f.byteLength}return s},utilConcatView:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){var u=o[a];e+=u.length}for(var s=new ArrayBuffer(e),c=new Uint8Array(s),l=0,h=n;l<h.length;l++){var f=h[l];c.set(f,t),t+=f.length}return c},utilDecodeTC:function(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(n),a=0;a<this.valueHex.byteLength;a++)i[a]=0;i[0]=128&e[0];for(var o=U(i,8),u=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(u),c=0;c<this.valueHex.byteLength;c++)s[c]=e[c];return s[0]&=127,U(s,8)-o},utilEncodeTC:function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var i=L(r-t,8,n);return new Uint8Array(i)[0]|=128,i}var a=L(t,8,n),o=new Uint8Array(a);if(128&o[0]){var u=a.slice(0),s=new Uint8Array(u);a=new ArrayBuffer(a.byteLength+1),o=new Uint8Array(a);for(var c=0;c<u.byteLength;c++)o[c+1]=s[c];o[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)},isEqualBuffer:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0},padNumber:function(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,i=new Array(n),a=0;a<n;a++)i[a]="0";return i.join("").concat(r)},toBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0,a=0,o=0,u="",s=t?P:H;if(n){for(var c=0,l=0;l<e.length;l++)if(0!==e.charCodeAt(l)){c=l;break}e=e.slice(c)}for(;i<e.length;){var h=e.charCodeAt(i++);i>=e.length&&(a=1);var f=e.charCodeAt(i++);i>=e.length&&(o=1);var v=e.charCodeAt(i++),p=h>>2,y=(3&h)<<4|f>>4,g=(15&f)<<2|v>>6,m=63&v;1===a?g=m=64:1===o&&(m=64),u+=r?64===g?"".concat(s.charAt(p)).concat(s.charAt(y)):64===m?"".concat(s.charAt(p)).concat(s.charAt(y)).concat(s.charAt(g)):"".concat(s.charAt(p)).concat(s.charAt(y)).concat(s.charAt(g)).concat(s.charAt(m)):"".concat(s.charAt(p)).concat(s.charAt(y)).concat(s.charAt(g)).concat(s.charAt(m))}return u},fromBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t?P:H;function i(e){for(var t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function a(e){return 64===e?0:e}for(var o=0,u="";o<e.length;){var s=i(e.charAt(o++)),c=o>=e.length?0:i(e.charAt(o++)),l=o>=e.length?0:i(e.charAt(o++)),h=o>=e.length?0:i(e.charAt(o++)),f=a(s)<<2|a(c)>>4,v=(15&a(c))<<4|a(l)>>2,p=(3&a(l))<<6|a(h);u+=String.fromCharCode(f),64!==l&&(u+=String.fromCharCode(v)),64!==h&&(u+=String.fromCharCode(p))}if(r){for(var y=u.length,g=-1,m=y-1;m>=0;m--)if(0!==u.charCodeAt(m)){g=m;break}u=-1!==g?u.slice(0,g+1):""}return u},arrayBufferToString:function(e){var t,r="",n=x(new Uint8Array(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;r+=String.fromCharCode(i)}}catch(e){n.e(e)}finally{n.f()}return r},stringToArrayBuffer:function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r},nearestPowerOf2:function(e){var t=Math.log(e)/I,r=Math.floor(t),n=Math.round(t);return r===n?r:n},clearProps:function(e,t){var r,n=x(t);try{for(n.s();!(r=n.n()).done;){delete e[r.value]}}catch(e){n.e(e)}finally{n.f()}}}),V=O((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBER=ye,t.compareSchema=ge,t.verifySchema=function(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=ye(e);if(-1===r.offset)return{verified:!1,result:r.result};return ge(r.result,r.result,t)},t.fromJSON=function(e){},t.RawData=t.Repeated=t.Any=t.Choice=t.TIME=t.Duration=t.DateTime=t.TimeOfDay=t.DATE=t.GeneralizedTime=t.UTCTime=t.CharacterString=t.GeneralString=t.VisibleString=t.GraphicString=t.IA5String=t.VideotexString=t.TeletexString=t.PrintableString=t.NumericString=t.UniversalString=t.BmpString=t.RelativeObjectIdentifier=t.Utf8String=t.ObjectIdentifier=t.Enumerated=t.Integer=t.BitString=t.OctetString=t.Null=t.Set=t.Sequence=t.Boolean=t.EndOfContent=t.Constructed=t.Primitive=t.BaseBlock=t.ValueBlock=t.HexBlock=void 0;var r=[new Uint8Array([1])],n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.blockLength=(0,_.getParametersValue)(t,"blockLength",0),this.error=(0,_.getParametersValue)(t,"error",""),this.warnings=(0,_.getParametersValue)(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return s(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:(0,_.bufferToHexCodes)(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),i=function(e){return function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).isHexOnly=(0,_.getParametersValue)(n,"isHexOnly",!1),e.valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e}return s(r,[{key:"fromBER",value:function(e,t,r){return!1===(0,_.checkBufferParams)(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}(e)};t.HexBlock=i;var a=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this),"idBlock"in n?(e.isHexOnly=(0,_.getParametersValue)(n.idBlock,"isHexOnly",!1),e.valueHex=(0,_.getParametersValue)(n.idBlock,"valueHex",new ArrayBuffer(0)),e.tagClass=(0,_.getParametersValue)(n.idBlock,"tagClass",-1),e.tagNumber=(0,_.getParametersValue)(n.idBlock,"tagNumber",-1),e.isConstructed=(0,_.getParametersValue)(n.idBlock,"isConstructed",!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return s(r,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var i=this.tagNumber;n|=i&=31,t[0]=n}return e}if(!1===this.isHexOnly){var a=(0,_.utilToBase)(this.tagNumber,7),o=new Uint8Array(a),u=a.byteLength;if(e=new ArrayBuffer(u+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var s=0;s<u-1;s++)t[s+1]=128|o[s];t[u]=o[u-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var c=new Uint8Array(this.valueHex),l=0;l<c.length-1;l++)t[l+1]=128|c[l];t[this.valueHex.byteLength]=c[c.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{var a=1;this.valueHex=new ArrayBuffer(255);for(var o=255,u=new Uint8Array(this.valueHex);128&n[a];){if(u[a-1]=127&n[a],++a>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(a===o){o+=255;for(var s=new ArrayBuffer(o),c=new Uint8Array(s),l=0;l<u.length;l++)c[l]=u[l];this.valueHex=new ArrayBuffer(o),u=new Uint8Array(this.valueHex)}}this.blockLength=a+1,u[a-1]=127&n[a];for(var h=new ArrayBuffer(a),f=new Uint8Array(h),v=0;v<a;v++)f[v]=u[v];this.valueHex=new ArrayBuffer(a),(u=new Uint8Array(this.valueHex)).set(f),this.blockLength<=9?this.tagNumber=(0,_.utilFromBase)(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(i(n)),u=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this),"lenBlock"in n?(e.isIndefiniteForm=(0,_.getParametersValue)(n.lenBlock,"isIndefiniteForm",!1),e.longFormUsed=(0,_.getParametersValue)(n.lenBlock,"longFormUsed",!1),e.length=(0,_.getParametersValue)(n.lenBlock,"length",0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var a=new Uint8Array(i),o=0;o<i;o++)a[o]=n[o+1];return 0===a[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=(0,_.utilFromBase)(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=(0,_.utilToBase)(this.length,8);if(n.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var i=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var a=0;a<n.byteLength;a++)t[a+1]=i[a];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(n),c=function(e){f(r,e);var t=w(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),r}(n);t.ValueBlock=c;var l=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return o(this,r),e=t.call(this,n),"name"in n&&(e.name=n.name),"optional"in n&&(e.optional=n.optional),"primitiveSchema"in n&&(e.primitiveSchema=n.primitiveSchema),e.idBlock=new a(n),e.lenBlock=new u(n),e.valueBlock=new i(n),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.idBlock.toBER(t),n=this.valueBlock.toBER(!0);this.lenBlock.length=n.byteLength;var i,a=this.lenBlock.toBER(t);if(e=(0,_.utilConcatBuf)(r,a),i=!1===t?this.valueBlock.toBER(t):new ArrayBuffer(this.lenBlock.length),e=(0,_.utilConcatBuf)(e,i),!0===this.lenBlock.isIndefiniteForm){var o=new ArrayBuffer(2);if(!1===t){var u=new Uint8Array(o);u[0]=0,u[1]=0}e=(0,_.utilConcatBuf)(e,o)}return e}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),r}(n);t.BaseBlock=l;var h=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e.isHexOnly=(0,_.getParametersValue)(n,"isHexOnly",!0),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),a=0;a<n.length;a++)i[a]=n[a];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),r}(c),p=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,h)).idBlock.isConstructed=!1,e}return s(r,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),r}(l);t.Primitive=p;var y=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).value=(0,_.getParametersValue)(n,"value",[]),e.isIndefiniteForm=(0,_.getParametersValue)(n,"isIndefiniteForm",!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=t,i=r;if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var a,o,u=t;a=this.isIndefiniteForm,o=r,(!0===a?1:o)>0;){var s=pe(e,u,r);if(-1===s.offset)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(u=s.offset,this.blockLength+=s.result.blockLength,r-=s.result.blockLength,this.value.push(s.result),!0===this.isIndefiniteForm&&s.result.constructor.blockName()===d.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===d.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+i),u}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);t=(0,_.utilConcatBuf)(t,n)}return t}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(c),g=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,y)).idBlock.isConstructed=!0,e}return s(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),r}(l);t.Constructed=g;var m=function(e){f(r,e);var t=w(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),t.call(this,e)}return s(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),r}(c),d=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,m)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return s(r,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),r}(l);t.EndOfContent=d;var k=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,r),(e=t.call(this,n)).value=(0,_.getParametersValue)(n,"value",!1),e.isHexOnly=(0,_.getParametersValue)(n,"isHexOnly",!1),"valueHex"in n)e.valueHex=n.valueHex.slice(0);else if(e.valueHex=new ArrayBuffer(1),!0===e.value){var i=new Uint8Array(e.valueHex);i[0]=255}return e}return s(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),a=0;a<n.length;a++)i[a]=n[a];return 0!==_.utilDecodeTC.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),r}(c),B=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,k)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return s(r,null,[{key:"blockName",value:function(){return"Boolean"}}]),r}(l);t.Boolean=B;var A=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return s(r,null,[{key:"blockName",value:function(){return"Sequence"}}]),r}(g);t.Sequence=A;var S=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return s(r,null,[{key:"blockName",value:function(){return"Set"}}]),r}(g);t.Set=S;var x=function(e){f(r,e);var t=w(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,i,n)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return s(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}}],[{key:"blockName",value:function(){return"Null"}}]),r}(l);t.Null=x;var C=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).isConstructed=(0,_.getParametersValue)(n,"isConstructed",!1),e}return s(r,[{key:"fromBER",value:function(e,t,n){var i=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(i=y.prototype.fromBER.call(this,e,t,n)))return i;for(var a=0;a<this.value.length;a++){var o=this.value[a].constructor.blockName();if(o===d.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==R.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=b(v(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return i}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return y.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),r}(i(y)),R=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,C)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return s(r,[{key:"fromBER",value:function(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t):b(v(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"OctetString"}}]),r}(l);t.OctetString=R;var N=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).unusedBits=(0,_.getParametersValue)(n,"unusedBits",0),e.isConstructed=(0,_.getParametersValue)(n,"isConstructed",!1),e.blockLength=e.valueHex.byteLength,e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=y.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var a=this.value[i].constructor.blockName();if(a===d.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(a!==E.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[i].valueBlock.unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[i].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var o=new Uint8Array(e,t,r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(o.length-1);for(var u=new Uint8Array(this.valueHex),s=0;s<r-1;s++)u[s]=o[s+1];return this.blockLength=o.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return y.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),n=new Uint8Array(r);n[0]=this.unusedBits;for(var i=0;i<this.valueHex.byteLength;i++)n[i+1]=t[i];return r}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),r}(i(y)),E=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,N)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return s(r,[{key:"fromBER",value:function(e,t,n){return 0===n?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,b(v(r.prototype),"fromBER",this).call(this,e,t,n))}},{key:"isEqual",value:function(e){return e instanceof r!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"BitString"}}]),r}(l);t.BitString=E;var K=function(e){f(n,e);var t=w(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,n),e=t.call(this,r),"value"in r&&(e.valueDec=r.value),e}return s(n,[{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.fromBER(e,t,r);if(-1===i)return i;var a=new Uint8Array(this._valueHex);if(0===a[0]&&0!=(128&a[1])){var o=new ArrayBuffer(this._valueHex.byteLength-1),u=new Uint8Array(o);u.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=o.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var s=new ArrayBuffer(n),c=new Uint8Array(s);c.set(a,n-this._valueHex.byteLength),this._valueHex=s.slice(0)}return i}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var i=new ArrayBuffer(this._valueHex.byteLength-1),a=new Uint8Array(i);a.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=i.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,r){var i=b(v(n.prototype),"fromBER",this).call(this,e,t,r);return-1===i?i:(this.blockLength=r,t+r)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=b(v(n.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),a=n.slice(0),o=a.length-1,u=i.slice(0),s=u.length-1,c=0,l=0,h=s<o?o:s;h>=0;h--,l++){switch(!0){case l<u.length:c=a[o-l]+u[s-l]+r[0];break;default:c=a[o-l]+r[0]}switch(r[0]=c/10,!0){case l>=a.length:a=(0,_.utilConcatView)(new Uint8Array([c%10]),a);break;default:a[o-l]=c%10}}return r[0]>0&&(a=(0,_.utilConcatView)(r,a)),a.slice(0)}function t(e){if(e>=r.length)for(var t=r.length;t<=e;t++){for(var n=new Uint8Array([0]),i=r[t-1].slice(0),a=i.length-1;a>=0;a--){var o=new Uint8Array([(i[a]<<1)+n[0]]);n[0]=o[0]/10,i[a]=o[0]%10}n[0]>0&&(i=(0,_.utilConcatView)(n,i)),r.push(i)}return r[e]}function n(e,t){for(var r,n=0,i=new Uint8Array(e),a=new Uint8Array(t),o=i.slice(0),u=o.length-1,s=a.slice(0),c=s.length-1,l=0,h=c;h>=0;h--,l++)switch(r=o[u-l]-s[c-l]-n,!0){case r<0:n=1,o[u-l]=r+10;break;default:n=0,o[u-l]=r}if(n>0)for(var f=u-c+1;f>=0;f--,l++){if(!((r=o[u-l]-n)<0)){n=0,o[u-l]=r;break}n=1,o[u-l]=r+10}return o.slice()}for(var i,a=8*this._valueHex.byteLength-1,o=new Uint8Array(8*this._valueHex.byteLength/3),u=0,s=new Uint8Array(this._valueHex),c="",l=!1,h=this._valueHex.byteLength-1;h>=0;h--){i=s[h];for(var f=0;f<8;f++){if(1==(1&i))switch(u){case a:o=n(t(u),o),c="-";break;default:o=e(o,t(u))}u++,i>>=1}}for(var v=0;v<o.length;v++)o[v]&&(l=!0),l&&(c+="0123456789".charAt(o[v]));return!1===l&&(c+="0123456789".charAt(0)),c}},{key:"valueHex",set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=_.utilDecodeTC.call(this)))},get:function(){return this._valueHex}},{key:"valueDec",set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=(0,_.utilEncodeTC)(e)},get:function(){return this._valueDec}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),n}(i(c)),O=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,K)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return s(r,[{key:"isEqual",value:function(e){return e instanceof r?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?(0,_.isEqualBuffer)(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&(0,_.isEqualBuffer)(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new r({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}}],[{key:"blockName",value:function(){return"Integer"}}]),r}(l);t.Integer=O;var U=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return s(r,null,[{key:"blockName",value:function(){return"Enumerated"}}]),r}(O);t.Enumerated=U;var L=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).valueDec=(0,_.getParametersValue)(n,"valueDec",-1),e.isFirstSid=(0,_.getParametersValue)(n,"isFirstSid",!1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var i=new Uint8Array(this.valueHex),a=0;a<r&&(i[a]=127&n[a],this.blockLength++,0!=(128&n[a]));a++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=i[s];return this.valueHex=o.slice(0),i=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===i[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,_.utilFromBase)(i,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var i=0;i<this.blockLength-1;i++)t[i]=128|n[i];return t[this.blockLength-1]=n[this.blockLength-1],e}var a=(0,_.utilToBase)(this.valueDec,7);if(0===a.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(a.byteLength),!1===r){var o=new Uint8Array(a);t=new Uint8Array(e);for(var u=0;u<a.byteLength-1;u++)t[u]=128|o[u];t[a.byteLength-1]=o[a.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),r}(i(n)),H=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).fromString((0,_.getParametersValue)(n,"value","")),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new L;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;0===this.value.length&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,_.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",i=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,i){var a=this.value[0],o=0;switch(a.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return this.value=[],!1}var u=parseInt(n,10);if(isNaN(u))return!0;a.valueDec=u+o,i=!1}else{var s=new L;if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;0===this.value.length&&(s.isFirstSid=!0,i=!0),this.value.push(s)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(c),P=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,H)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return s(r,null,[{key:"blockName",value:function(){return"ObjectIdentifier"}}]),r}(l);t.ObjectIdentifier=P;var I=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),r}(i(n)),T=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this,n,I),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '.concat(e,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),i=0;i<r;i++)n[i]=t.charCodeAt(i);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"Utf8String"}}]),r}(l);t.Utf8String=T;var D=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).valueDec=(0,_.getParametersValue)(n,"valueDec",-1),e}return s(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,_.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var i=new Uint8Array(this.valueHex),a=0;a<r&&(i[a]=127&n[a],this.blockLength++,0!=(128&n[a]));a++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=i[s];return this.valueHex=o.slice(0),i=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===i[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,_.utilFromBase)(i,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var i=0;i<this.blockLength-1;i++)t[i]=128|n[i];return t[this.blockLength-1]=n[this.blockLength-1],e}var a=(0,_.utilToBase)(this.valueDec,7);if(0===a.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(a.byteLength),!1===r){var o=new Uint8Array(a);t=new Uint8Array(e);for(var u=0;u<a.byteLength-1;u++)t[u]=128|o[u];t[a.byteLength-1]=o[a.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?(0,_.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),r}(i(n)),j=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).fromString((0,_.getParametersValue)(n,"value","")),e}return s(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new D;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,_.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var i=new D;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),r}(c),V=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n,j)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return s(r,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),r}(l);t.RelativeObjectIdentifier=V;var J=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),r}(i(n)),M=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this,n,J),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var i=r[n];r[n]=r[n+1],r[n+1]=i}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var i=(0,_.utilToBase)(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>2))for(var o=2-a.length,u=a.length-1;u>=0;u--)r[2*n+u+o]=a[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"BmpString"}}]),r}(l);t.BmpString=M;var F=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),r}(i(n)),z=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this,n,F),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var i=(0,_.utilToBase)(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>4))for(var o=4-a.length,u=a.length-1;u>=0;u--)r[4*n+u+o]=a[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"UniversalString"}}]),r}(l);t.UniversalString=z;var G=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).value="",e.isHexOnly=!0,e}return s(r,[{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),r}(i(n)),q=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),e=t.call(this,n,G),"value"in n&&e.fromString(n.value),e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),r}(l),W=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return s(r,null,[{key:"blockName",value:function(){return"NumericString"}}]),r}(q);t.NumericString=W;var Z=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return s(r,null,[{key:"blockName",value:function(){return"PrintableString"}}]),r}(q);t.PrintableString=Z;var $=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return s(r,null,[{key:"blockName",value:function(){return"TeletexString"}}]),r}(q);t.TeletexString=$;var X=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return s(r,null,[{key:"blockName",value:function(){return"VideotexString"}}]),r}(q);t.VideotexString=X;var Y=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return s(r,null,[{key:"blockName",value:function(){return"IA5String"}}]),r}(q);t.IA5String=Y;var Q=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return s(r,null,[{key:"blockName",value:function(){return"GraphicString"}}]),r}(q);t.GraphicString=Q;var ee=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return s(r,null,[{key:"blockName",value:function(){return"VisibleString"}}]),r}(q);t.VisibleString=ee;var te=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return s(r,null,[{key:"blockName",value:function(){return"GeneralString"}}]),r}(q);t.GeneralString=te;var re=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return s(r,null,[{key:"blockName",value:function(){return"CharacterString"}}]),r}(q);t.CharacterString=re;var ne=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),a=0;a<n.value.length;a++)i[a]=n.value.charCodeAt(a)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=(0,_.padNumber)(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=(0,_.padNumber)(this.month,2),e[2]=(0,_.padNumber)(this.day,2),e[3]=(0,_.padNumber)(this.hour,2),e[4]=(0,_.padNumber)(this.minute,2),e[5]=(0,_.padNumber)(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),r}(ee);t.UTCTime=ne;var ie=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var i=new Uint8Array(e.valueBlock.valueHex),a=0;a<n.value.length;a++)i[a]=n.value.charCodeAt(a)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return s(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",i="",a=0,o=0,u=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var s=new Number(e[e.length-1]);if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var c=1,l=n.indexOf("+"),h="";if(-1===l&&(l=n.indexOf("-"),c=-1),-1!==l){if(h=n.substr(l+1),n=n.substr(0,l),2!==h.length&&4!==h.length)throw new Error("Wrong input string for convertion");var f=new Number(h.substr(0,2));if(isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");if(o=c*f,4===h.length){if(f=new Number(h.substr(2,2)),isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");u=c*f}}}var v=n.indexOf(".");if(-1===v&&(v=n.indexOf(",")),-1!==v){var p=new Number("0".concat(n.substr(v)));if(isNaN(p.valueOf()))throw new Error("Wrong input string for convertion");a=p.valueOf(),i=n.substr(0,v)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==v)throw new Error("Wrong input string for convertion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var y=60*a;this.minute=Math.floor(y),y=60*(y-this.minute),this.second=Math.floor(y),y=1e3*(y-this.second),this.millisecond=Math.floor(y)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var g=60*a;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var m=1e3*a;this.millisecond=Math.floor(m)}break;default:throw new Error("Wrong input string for convertion")}var d=t.exec(i);if(null===d)throw new Error("Wrong input string for convertion");for(var k=1;k<d.length;k++)switch(k){case 1:this.year=parseInt(d[k],10);break;case 2:this.month=parseInt(d[k],10);break;case 3:this.day=parseInt(d[k],10);break;case 4:this.hour=parseInt(d[k],10)+o;break;case 5:this.minute=parseInt(d[k],10)+u;break;case 6:this.second=parseInt(d[k],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push((0,_.padNumber)(this.year,4)),e.push((0,_.padNumber)(this.month,2)),e.push((0,_.padNumber)(this.day,2)),e.push((0,_.padNumber)(this.hour,2)),e.push((0,_.padNumber)(this.minute,2)),e.push((0,_.padNumber)(this.second,2)),0!==this.millisecond&&(e.push("."),e.push((0,_.padNumber)(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=b(v(r.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),r}(ee);t.GeneralizedTime=ie;var ae=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return s(r,null,[{key:"blockName",value:function(){return"DATE"}}]),r}(T);t.DATE=ae;var oe=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return s(r,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),r}(T);t.TimeOfDay=oe;var ue=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return s(r,null,[{key:"blockName",value:function(){return"DateTime"}}]),r}(T);t.DateTime=ue;var se=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return s(r,null,[{key:"blockName",value:function(){return"Duration"}}]),r}(T);t.Duration=se;var ce=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return s(r,null,[{key:"blockName",value:function(){return"TIME"}}]),r}(T);t.TIME=ce;var le=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.value=(0,_.getParametersValue)(t,"value",[]),this.optional=(0,_.getParametersValue)(t,"optional",!1)};t.Choice=le;var he=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.name=(0,_.getParametersValue)(t,"name",""),this.optional=(0,_.getParametersValue)(t,"optional",!1)};t.Any=he;var fe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.name=(0,_.getParametersValue)(t,"name",""),this.optional=(0,_.getParametersValue)(t,"optional",!1),this.value=(0,_.getParametersValue)(t,"value",new he),this.local=(0,_.getParametersValue)(t,"local",!1)};t.Repeated=fe;var ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.data=(0,_.getParametersValue)(t,"data",new ArrayBuffer(0))}return s(e,[{key:"fromBER",value:function(e,t,r){return this.data=e.slice(t,r),t+r}},{key:"toBER",value:function(){return this.data}}]),e}();function pe(e,t,r){var i=t;var a=new l({},Object),o=new n;if(!1===(0,_.checkBufferParams)(o,e,t,r))return a.error=o.error,{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return this.error="Zero buffer length",{offset:-1,result:a};var u=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===u)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=u,r-=a.idBlock.blockLength,u=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===u)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=u,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var s=l;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};s=d;break;case 1:s=B;break;case 2:s=O;break;case 3:s=E;break;case 4:s=R;break;case 5:s=x;break;case 6:s=P;break;case 10:s=U;break;case 12:s=T;break;case 13:s=V;break;case 14:s=ce;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:s=A;break;case 17:s=S;break;case 18:s=W;break;case 19:s=Z;break;case 20:s=$;break;case 21:s=X;break;case 22:s=Y;break;case 23:s=ne;break;case 24:s=ie;break;case 25:s=Q;break;case 26:s=ee;break;case 27:s=te;break;case 28:s=z;break;case 29:s=re;break;case 30:s=M;break;case 31:s=ae;break;case 32:s=oe;break;case 33:s=ue;break;case 34:s=se;break;default:var c;(c=!0===a.idBlock.isConstructed?new g:new p).idBlock=a.idBlock,c.lenBlock=a.lenBlock,c.warnings=a.warnings,u=(a=c).fromBER(e,t,r)}break;case 2:case 3:case 4:default:s=!0===a.idBlock.isConstructed?g:p}return u=(a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,s)).fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(i,i+a.blockLength),{offset:u,result:a}}function ye(e){if(0===e.byteLength){var t=new l({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return pe(e,0,e.byteLength)}function ge(e,t,r){if(r instanceof le){for(var n=0;n<r.value.length;n++){if(!0===ge(e,t,r.value[n]).verified)return{verified:!0,result:e}}var i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(i.name=r.name),i}if(r instanceof he)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var a=r.idBlock.toBER(!1);if(0===a.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(a,0,a.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=new Uint8Array(r.idBlock.valueHex),u=new Uint8Array(t.idBlock.valueHex);if(o.length!==u.length)return{verified:!1,result:e};for(var s=0;s<o.length;s++)if(o[s]!==u[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var c=0,l={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof fe&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,v=0;v<r.valueBlock.value.length;v++)f=f&&(r.valueBlock.value[v].optional||!1);return!0===f?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var p=0;p<h;p++)if(p-c>=t.valueBlock.value.length){if(!1===r.valueBlock.value[p].optional){var y={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],y.name=r.name)),y}}else if(r.valueBlock.value[0]instanceof fe){if(!1===(l=ge(e,t.valueBlock.value[p],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[p])}}else if(!1===(l=ge(e,t.valueBlock.value[p-c],r.valueBlock.value[p])).verified){if(!0!==r.valueBlock.value[p].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if(!1===l.verified){var m={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],m.name=r.name)),m}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var d=ye(t.valueBlock.valueHex);if(-1===d.offset){var k={verified:!1,result:d.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],k.name=r.name)),k}return ge(e,d.result,r.primitiveSchema)}return{verified:!0,result:e}}t.RawData=ve})),J=(T=V)&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T,M=V.fromBER,F=V.compareSchema,z=V.verifySchema,G=V.fromJSON,q=V.RawData,W=V.Repeated,Z=V.Any,$=V.Choice,X=V.TIME,Y=V.Duration,Q=V.DateTime,ee=V.TimeOfDay,te=V.DATE,re=V.GeneralizedTime,ne=V.UTCTime,ie=V.CharacterString,ae=V.GeneralString,oe=V.VisibleString,ue=V.GraphicString,se=V.IA5String,ce=V.VideotexString,le=V.TeletexString,he=V.PrintableString,fe=V.NumericString,ve=V.UniversalString,pe=V.BmpString,ye=V.RelativeObjectIdentifier,ge=V.Utf8String,me=V.ObjectIdentifier,de=V.Enumerated,ke=V.Integer,we=V.BitString,be=V.OctetString,Be=V.Null,Ae=V.Set,Se=V.Sequence,xe=V.Boolean,Ce=V.EndOfContent,Re=V.Constructed,Ne=V.Primitive,Ee=V.BaseBlock,Ke=V.ValueBlock,Oe=V.HexBlock,Ue=Object.freeze({__proto__:null,default:J,__moduleExports:V,fromBER:M,compareSchema:F,verifySchema:z,fromJSON:G,RawData:q,Repeated:W,Any:Z,Choice:$,TIME:X,Duration:Y,DateTime:Q,TimeOfDay:ee,DATE:te,GeneralizedTime:re,UTCTime:ne,CharacterString:ie,GeneralString:ae,VisibleString:oe,GraphicString:ue,IA5String:se,VideotexString:ce,TeletexString:le,PrintableString:he,NumericString:fe,UniversalString:ve,BmpString:pe,RelativeObjectIdentifier:ye,Utf8String:ge,ObjectIdentifier:me,Enumerated:de,Integer:ke,BitString:we,OctetString:be,Null:Be,Set:Ae,Sequence:Se,Boolean:xe,EndOfContent:Ce,Constructed:Re,Primitive:Ne,BaseBlock:Ee,ValueBlock:Ke,HexBlock:Oe});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(D||(D={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(j||(j={}));var Le={fromASN:function(e){return e instanceof Be?null:e.valueBeforeDecode},toASN:function(e){if(null===e)return new Be;var t=M(e);if(t.result.error)throw new Error(t.result.error);return t.result}},He={fromASN:function(e){return e.valueBlock.valueHex.byteLength>4?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new ke({value:e})}},Pe={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new de({value:e})}},Ie={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new we({valueHex:e})}},Te={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new me({value:e})}},De={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new xe({value:e})}},je={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new be({valueHex:e})}};function _e(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var Ve=_e(ge),Je=_e(pe),Me=_e(ve),Fe=_e(fe),ze=_e(he),Ge=_e(le),qe=_e(ce),We=_e(se),Ze=_e(ue),$e=_e(oe),Xe=_e(ae),Ye=_e(ie),Qe={fromASN:function(e){return e.toDate()},toASN:function(e){return new ne({valueDate:e})}},et={fromASN:function(e){return e.toDate()},toASN:function(e){return new re({valueDate:e})}},tt={fromASN:function(e){return null},toASN:function(e){return new Be}};function rt(e){switch(e){case j.Any:return Le;case j.BitString:return Ie;case j.BmpString:return Je;case j.Boolean:return De;case j.CharacterString:return Ye;case j.Enumerated:return Pe;case j.GeneralString:return Xe;case j.GeneralizedTime:return et;case j.GraphicString:return Ze;case j.IA5String:return We;case j.Integer:return He;case j.Null:return tt;case j.NumericString:return Fe;case j.ObjectIdentifier:return Te;case j.OctetString:return je;case j.PrintableString:return ze;case j.TeletexString:return Ge;case j.UTCTime:return Qe;case j.UniversalString:return Me;case j.Utf8String:return Ve;case j.VideotexString:return qe;case j.VisibleString:return $e;default:return null}}function nt(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||nt(e.prototype):!!(e&&e.toASN&&e.fromASN)}function it(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<e.byteLength;i++)if(r[i]!==n[i])return!1;return!0}var at,ot=new(function(){function e(){o(this,e),this.items=new WeakMap}return s(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t,r,n,i,a=this.items.get(e);if(!a)throw new Error("Cannot get schema for '".concat(null!==(i=null===(n=null===(r=null===(t=e)||void 0===t?void 0:t.prototype)||void 0===r?void 0:r.constructor)||void 0===n?void 0:n.name)&&void 0!==i?i:e,"' target"));return a}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:D.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var i in r.items){var a=r.items[i],o=t?i:"",u=void 0;if("number"==typeof a.type){var s=j[a.type],c=Ue[s];if(!c)throw new Error("Cannot get ASN1 class by name '".concat(s,"'"));u=new c({name:o})}else if(nt(a.type)){u=(new a.type).toSchema(o)}else if(a.optional){this.get(a.type).type===D.Choice?u=new Z({name:o}):(u=this.create(a.type,!1)).name=o}else u=new Z({name:o});var l=!!a.optional||void 0!==a.defaultValue;if(a.repeated)u.name="",u=new("set"===a.repeated?Ae:Se)({name:"",value:[new W({name:o,value:u})]});if(null!==a.context&&void 0!==a.context)if(a.implicit)if("number"==typeof a.type||nt(a.type)){var h=a.repeated?Re:Ne;n.push(new h({name:o,optional:l,idBlock:{tagClass:3,tagNumber:a.context}}))}else{this.cache(a.type);var f=!!a.repeated,v=f?u:this.get(a.type).schema;v=v.valueBlock?v.valueBlock.value:v.value,n.push(new Re({name:f?"":o,optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:v}))}else n.push(new Re({optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else u.optional=l,n.push(u)}switch(r.type){case D.Sequence:return new Se({value:n,name:""});case D.Set:return new Ae({value:n,name:""});case D.Choice:return new $({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),ut=function(e){return function(t){var r;ot.has(t)?r=ot.get(t):(r=ot.createDefault(t),ot.set(t,r)),Object.assign(r,e)}},st=function(e){return function(t,r){var n;ot.has(t.constructor)?n=ot.get(t.constructor):(n=ot.createDefault(t.constructor),ot.set(t.constructor,n));var i=Object.assign({},e);if("number"==typeof i.type&&!i.converter){var a=rt(e.type);if(!a)throw new Error("Cannot get default converter for property '".concat(r,"' of ").concat(t.constructor.name));i.converter=a}n.items[r]=i}},ct=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).schemas=[],e}return r}(m(Error)),lt=function(){function e(){o(this,e)}return s(e,null,[{key:"parse",value:function(e,t){var r;if(e instanceof ArrayBuffer)r=e;else if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))r=new Uint8Array(e).buffer;else{if(!(ArrayBuffer.isView(e)||e.buffer instanceof ArrayBuffer))throw new TypeError("Wrong type of 'data' argument");r=e.buffer}var n=M(r);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}},{key:"fromASN",value:function(e,t){var r,n=this;try{if(nt(t))return(new t).fromASN(e);var i=ot.get(t);ot.cache(t);var a=i.schema;if(e.constructor===Re&&i.type!==D.Choice)for(var o in a=new Re({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value}),i.items)delete e[o];var u=F(e,e,a);if(!u.verified)throw new ct("Data does not match to ".concat(t.name," ASN1 schema. ").concat(u.result.error));var s=new t;if(function e(t){var r;if(t){var n=Object.getPrototypeOf(t);return(null===(r=null==n?void 0:n.prototype)||void 0===r?void 0:r.constructor)===Array||e(n)}return!1}(t)){if("number"==typeof i.itemType){var c=rt(i.itemType);if(!c)throw new Error("Cannot get default converter for array item of ".concat(t.name," ASN1 schema"));return t.from(e.valueBlock.value,(function(e){return c.fromASN(e)}))}return t.from(e.valueBlock.value,(function(e){return n.fromASN(e,i.itemType)}))}var l=function(t){if(!e[t])return"continue";var a=i.items[t];if("number"==typeof a.type||nt(a.type)){var o=null!==(r=a.converter)&&void 0!==r?r:nt(a.type)?new a.type:null;if(!o)throw new Error("Converter is empty");if(a.repeated)if(a.implicit){var u=new("sequence"===a.repeated?Se:Ae);u.valueBlock=e[t].valueBlock;var c=M(u.toBER(!1)).result.valueBlock.value;s[t]=Array.from(c,(function(e){return o.fromASN(e)}))}else s[t]=Array.from(e[t],(function(e){return o.fromASN(e)}));else{var l=e[t];if(a.implicit){var h;if(nt(a.type))h=(new a.type).toSchema("");else{var f=j[a.type],v=Ue[f];if(!v)throw new Error("Cannot get '".concat(f,"' class from asn1js module"));h=new v}h.valueBlock=l.valueBlock,l=M(h.toBER(!1)).result}s[t]=o.fromASN(l)}}else a.repeated?s[t]=Array.from(e[t],(function(e){return n.fromASN(e,a.type)})):s[t]=n.fromASN(e[t],a.type)};for(var h in i.items)l(h);return s}catch(e){throw e instanceof ct&&e.schemas.push(t.name),e}}}]),e}(),ht=function(){function e(){o(this,e)}return s(e,null,[{key:"serialize",value:function(e){return e instanceof Ee?e.toBER(!1):this.toASN(e).toBER(!1)}},{key:"toASN",value:function(t){var r=this;if(t&&nt(t.constructor))return t.toASN();var i=t.constructor,a=ot.get(i);ot.cache(i);var o,u=[];if(a.itemType)if("number"==typeof a.itemType){var s=rt(a.itemType);if(!s)throw new Error("Cannot get default converter for array item of ".concat(i.name," ASN1 schema"));u=t.map((function(e){return s.toASN(e)}))}else u=t.map((function(e){return r.toAsnItem({type:a.itemType},"[]",i,e)}));else for(var c in a.items){var l=a.items[c],h=t[c];if(!(void 0===h||l.defaultValue===h||"object"===n(l.defaultValue)&&"object"===n(h)&&it(this.serialize(l.defaultValue),this.serialize(h)))){var f=e.toAsnItem(l,c,i,h);if("number"==typeof l.context)if(l.implicit)if(l.repeated||"number"!=typeof l.type&&!nt(l.type))u.push(new Re({optional:l.optional,idBlock:{tagClass:3,tagNumber:l.context},value:f.valueBlock.value}));else{var v={};v.valueHex=f.valueBlock.toBER(),u.push(new Ne(Object.assign({optional:l.optional,idBlock:{tagClass:3,tagNumber:l.context}},v)))}else u.push(new Re({optional:l.optional,idBlock:{tagClass:3,tagNumber:l.context},value:[f]}));else l.repeated?u=u.concat(f):u.push(f)}}switch(a.type){case D.Sequence:o=new Se({value:u});break;case D.Set:o=new Ae({value:u});break;case D.Choice:if(!u[0])throw new Error("Schema '".concat(i.name,"' has wrong data. Choice cannot be empty."));o=u[0]}return o}},{key:"toAsnItem",value:function(e,t,r,n){var i,a=this;if("number"==typeof e.type){var o=e.converter;if(!o)throw new Error("Property '".concat(t,"' doesn't have converter for type ").concat(j[e.type]," in schema '").concat(r.name,"'"));if(e.repeated){var u=Array.from(n,(function(e){return o.toASN(e)}));i=new("sequence"===e.repeated?Se:Ae)({value:u})}else i=o.toASN(n)}else if(e.repeated){var s=Array.from(n,(function(e){return a.toASN(e)}));i=new("sequence"===e.repeated?Se:Ae)({value:s})}else i=this.toASN(n);return i}}]),e}(),ft=function(e){f(r,e);var t=w(r);function r(e,n){var i;return o(this,r),(i=t.call(this,n?"".concat(e,". See the inner exception for more details."):e)).message=e,i.innerError=n,i}return r}(m(Error)),vt=function(e){f(r,e);var t=w(r);function r(e,n,i){return o(this,r),t.call(this,e,"JSON doesn't match to '".concat(e.target.name,"' schema. ").concat(n),i)}return r}(function(e){f(r,e);var t=w(r);function r(e,n,i){var a;return o(this,r),(a=t.call(this,n,i)).schema=e,a}return r}(ft)),pt=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return r}(ft),yt=function(e){f(r,e);var t=w(r);function r(e,n,i){var a;return o(this,r),(a=t.call(this,"Cannot serialize by '".concat(e,"' schema. ").concat(n),i)).schemaName=e,a}return r}(ft),gt=function(e){f(r,e);var t=w(r);function r(e,n){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o(this,r),(i=t.call(this,e,"Some keys doesn't match to schema")).keys=n,i.errors=a,i}return r}(vt);function mt(e,t){if(!function(e,t){switch(t){case at.Boolean:return"boolean"==typeof e;case at.Number:return"number"==typeof e;case at.String:return"string"==typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(at[t]))}function dt(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||dt(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(at||(at={}));var kt=function(){function e(){o(this,e),this.items=new Map}return s(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}(),wt=new kt,bt=function(){function e(t){o(this,e),this.pattern=new RegExp(t)}return s(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new pt("Incoming value must be string");if(!t.exec(e))throw new pt("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;o(this,e),this.min=t,this.max=r}return s(e,[{key:"validate",value:function(e){if(mt(e,at.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new pt("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),At=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;o(this,e),this.min=t,this.max=r}return s(e,[{key:"validate",value:function(e){if(mt(e,at.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new pt("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),St=function(){function e(t,r,n){o(this,e),this.length=t,this.minLength=r,this.maxLength=n}return s(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new pt("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new pt("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new pt("Value length must be exactly ".concat(this.length,"."))}}]),e}(),xt=function(){function e(t){o(this,e),this.enumeration=t}return s(e,[{key:"validate",value:function(e){if(mt(e,at.String),!this.enumeration.includes(e))throw new pt("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}(),Ct=function(){function e(){o(this,e)}return s(e,null,[{key:"checkValues",value:function(e,t){var r,n=x(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,o=x(t.validations);try{for(o.s();!(i=o.n()).done;){var u=i.value;u instanceof St&&t.repeated?u.validate(e):u.validate(a)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkTypes",value:function(e,t){if(t.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if("number"==typeof t.type){var r,n=x(Array.isArray(e)?e:[e]);try{for(n.s();!(r=n.n()).done;){mt(r.value,t.type)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getSchemaByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return h(h({},e.names.default),e.names[t])}}]),e}(),Rt=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,null,[{key:"serialize",value:function(e,t,r,n){var i=this.toJSON(e,t);return JSON.stringify(i,r,n)}},{key:"toJSON",value:function(e){var t,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.targetSchema,o=i.schemaName||"default";if(dt(e))return e.toJSON();if(Array.isArray(e)){t=[];var u,s=x(e);try{for(s.s();!(u=s.n()).done;){var c=u.value;t.push(this.toJSON(c,i))}}catch(e){s.e(e)}finally{s.f()}}else if("object"===n(e)){if(a&&!wt.has(a))throw new ft("Cannot get schema for `targetSchema` param");if(a=a||e.constructor,wt.has(a)){var l=wt.get(a);t={};var h=this.getSchemaByName(l,o);for(var f in h)try{var v=function(){var n=h[f],i=e[f],u=void 0;if(n.optional&&void 0===i||void 0!==n.defaultValue&&i===n.defaultValue)return"continue";if(!n.optional&&void 0===i)throw new yt(a.name,"Property '".concat(f,"' is required."));u="number"==typeof n.type?n.converter?n.repeated?i.map((function(t){return n.converter.toJSON(t,e)})):n.converter.toJSON(i,e):i:n.repeated?i.map((function(e){return r.toJSON(e,{schemaName:o})})):r.toJSON(i,{schemaName:o}),r.checkTypes(u,n),r.checkValues(u,n),t[n.name||f]=u}();if("continue"===v)continue}catch(e){throw e instanceof yt?e:new yt(l.target.name,"Property '".concat(f,"' is wrong. ").concat(e.message),e)}}else for(var p in t={},e)t[p]=this.toJSON(e[p],{schemaName:o})}else t=e;return t}}]),r}(Ct),Nt=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,null,[{key:"parse",value:function(e,t){var r=JSON.parse(e);return this.fromJSON(r,t)}},{key:"fromJSON",value:function(e,t){var n=this,i=t.targetSchema,a=t.schemaName||"default",o=new i;if(dt(o))return o.fromJSON(e);var u=wt.get(i),s=this.getSchemaByName(u,a),c={};for(var l in t.strictProperty&&!Array.isArray(e)&&r.checkStrictProperty(e,s,u),s)try{if("continue"===function(){var r=s[l],i=r.name||l,c=e[i];if(void 0===c&&(r.optional||void 0!==r.defaultValue))return"continue";if(!r.optional&&void 0===c)throw new vt(u,"Property '".concat(i,"' is required."));if(n.checkTypes(c,r),n.checkValues(c,r),"number"==typeof r.type)r.converter?r.repeated?o[l]=c.map((function(e){return r.converter.fromJSON(e,o)})):o[l]=r.converter.fromJSON(c,o):o[l]=c;else{var f=h(h({},t),{},{targetSchema:r.type,schemaName:a});r.repeated?o[l]=c.map((function(e){return n.fromJSON(e,f)})):o[l]=n.fromJSON(c,f)}}())continue}catch(e){if(e instanceof vt||(e=new vt(u,"Property '".concat(l,"' is wrong. ").concat(e.message),e)),!t.strictAllKeys)throw e;c[l]=e}var f=Object.keys(c);if(f.length)throw new gt(u,f,c);return o}},{key:"checkStrictProperty",value:function(e,t,r){for(var n=Object.keys(e),i=Object.keys(t),a=[],o=0,u=n;o<u.length;o++){var s=u[o];-1===i.indexOf(s)&&a.push(s)}if(a.length)throw new gt(r,a)}}]),r}(Ct);function Et(e){var t=[];return e.pattern&&t.push(new bt(e.pattern)),e.type!==at.Number&&e.type!==at.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new Bt(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new At(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new xt(e.enumeration))),(e.type===at.String||e.repeated||e.type===at.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new St(e.length,e.minLength,e.maxLength))),t}var Kt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,i="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");wt.has(t.constructor)?(n=wt.get(t.constructor)).target!==t.constructor&&(n=wt.create(t.constructor),wt.set(t.constructor,n)):(n=wt.create(t.constructor),wt.set(t.constructor,n));var a={type:at.Any,validations:[]},o=Object.assign(a,e);if(o.validations=Et(o),"number"!=typeof o.type&&!wt.has(o.type)&&!dt(o.type))throw new Error("".concat(i,". Assigning type doesn't have schema."));var u,s=x(Array.isArray(e.schema)?e.schema:[e.schema||"default"]);try{for(s.s();!(u=s.n()).done;){var c=u.value;n.names[c]||(n.names[c]={}),n.names[c][r]=o}}catch(e){s.e(e)}finally{s.f()}}},Ot=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return r}(m(Error)),Ut=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return r}(Ot),Lt=function(e){f(r,e);var t=w(r);function r(e){return o(this,r),t.call(this,"Unsupported operation: ".concat(e?"".concat(e):""))}return r}(Ot),Ht=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return r}(Ot),Pt=function(e){f(r,e);var t=w(r);function r(e){return o(this,r),t.call(this,"".concat(e,": Missing required property"))}return r}(Ot);function It(e){return"object"===n(e)&&"kty"in e}var Tt=function(){function e(){o(this,e)}var t,r,n,i,u,c,l,h,f,v,p,y,g,m,d,k,w,b;return s(e,[{key:"digest",value:(b=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDigest.apply(this,r),e.abrupt("return",this.onDigest.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"checkDigest",value:function(e,t){this.checkAlgorithmName(e)}},{key:"onDigest",value:(w=a(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("digest");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return w.apply(this,arguments)})},{key:"generateKey",value:(k=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkGenerateKey.apply(this,r),e.abrupt("return",this.onGenerateKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"checkGenerateKey",value:function(e,t,r){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!r||!r.length)throw new TypeError("Usages cannot be empty when creating a key.");var n;n=Array.isArray(this.usages)?this.usages:this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(r,n)}},{key:"checkGenerateKeyParams",value:function(e){}},{key:"onGenerateKey",value:(d=a(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("generateKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return d.apply(this,arguments)})},{key:"sign",value:(m=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkSign.apply(this,r),e.abrupt("return",this.onSign.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"checkSign",value:function(e,t,r){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"sign")}},{key:"onSign",value:(g=a(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("sign");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return g.apply(this,arguments)})},{key:"verify",value:(y=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkVerify.apply(this,r),e.abrupt("return",this.onVerify.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"checkVerify",value:function(e,t,r,n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"verify")}},{key:"onVerify",value:(p=a(regeneratorRuntime.mark((function e(t,r,n,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("verify");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return p.apply(this,arguments)})},{key:"encrypt",value:(v=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkEncrypt.apply(this,r),e.abrupt("return",this.onEncrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"checkEncrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"encrypt":void 0)}},{key:"onEncrypt",value:(f=a(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("encrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"decrypt",value:(h=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDecrypt.apply(this,r),e.abrupt("return",this.onDecrypt.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"checkDecrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"decrypt":void 0)}},{key:"onDecrypt",value:(l=a(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("decrypt");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"deriveBits",value:(c=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkDeriveBits.apply(this,r),e.abrupt("return",this.onDeriveBits.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"checkDeriveBits",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"deriveBits":void 0),r%8!=0)throw new Ht("length: Is not multiple of 8")}},{key:"onDeriveBits",value:(u=a(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("deriveBits");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"exportKey",value:(i=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkExportKey.apply(this,r),e.abrupt("return",this.onExportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"checkExportKey",value:function(e,t){if(this.checkKeyFormat(e),this.checkCryptoKey(t),!t.extractable)throw new Ot("key: Is not extractable")}},{key:"onExportKey",value:(n=a(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("exportKey");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"importKey",value:(r=a(regeneratorRuntime.mark((function e(){var t,r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=i.length,r=new Array(t),n=0;n<t;n++)r[n]=i[n];return this.checkImportKey.apply(this,r),e.abrupt("return",this.onImportKey.apply(this,r));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkImportKey",value:function(e,t,r,n,i){this.checkKeyFormat(e),this.checkKeyData(e,t),this.checkAlgorithmName(r),this.checkImportParams(r),Array.isArray(this.usages)&&this.checkKeyUsages(i,this.usages)}},{key:"onImportKey",value:(t=a(regeneratorRuntime.mark((function e(t,r,n,i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Lt("importKey");case 1:case"end":return e.stop()}}),e)}))),function(e,r,n,i,a){return t.apply(this,arguments)})},{key:"checkAlgorithmName",value:function(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new Ut("Unrecognized name")}},{key:"checkAlgorithmParams",value:function(e){}},{key:"checkDerivedKeyParams",value:function(e){}},{key:"checkKeyUsages",value:function(e,t){var r,n=x(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(-1===t.indexOf(i))throw new TypeError("Cannot create a key using the specified key usages")}}catch(e){n.e(e)}finally{n.f()}}},{key:"checkCryptoKey",value:function(e,t){if(this.checkAlgorithmName(e.algorithm),t&&-1===e.usages.indexOf(t))throw new Ot("key does not match that of operation")}},{key:"checkRequiredProperty",value:function(e,t){if(!(t in e))throw new Pt(t)}},{key:"checkHashAlgorithm",value:function(e,t){var r,n=x(t);try{for(n.s();!(r=n.n()).done;){if(r.value.toLowerCase()===e.name.toLowerCase())return}}catch(e){n.e(e)}finally{n.f()}throw new Ht("hash: Must be one of ".concat(t.join(", ")))}},{key:"checkImportParams",value:function(e){}},{key:"checkKeyFormat",value:function(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}},{key:"checkKeyData",value:function(e,t){if(!t)throw new TypeError("keyData: Cannot be empty on empty on key importing");if("jwk"===e){if(!It(t))throw new TypeError("keyData: Is not JsonWebToken")}else if(!E.isBufferSource(t))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}},{key:"prepareData",value:function(e){return E.toArrayBuffer(e)}}]),e}(),Dt=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(Tt),jt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="AES-CBC",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.iv.byteLength)throw new TypeError("iv: Must have length 16 bytes")}}]),r}(Dt),_t=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="AES-CTR",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.counter.byteLength)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new Ht("length: Must be more than 0")}}]),r}(Dt),Vt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="AES-ECB",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return r}(Dt),Jt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="AES-GCM",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new Ht("iv: Must have length more than 0 and less than 2^64 - 1");switch("tagLength"in e||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new Ht("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}}]),r}(Dt),Mt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="AES-KW",e.usages=["wrapKey","unwrapKey"],e}return r}(Dt),Ft=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError("iv: Must have length ".concat(this.ivSize," bytes"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new Ht("algorith.length: Must be ".concat(this.keySizeBits))}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),r}(Tt),zt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return s(r,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=N.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(Tt),Gt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="RSASSA-PKCS1-v1_5",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return r}(zt),qt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="RSA-PSS",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"saltLength"),"number"!=typeof e.saltLength)throw new TypeError("saltLength: Is not a Number");if(e.saltLength<1)throw new RangeError("saltLength: Must be more than 0")}}]),r}(zt),Wt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="RSA-OAEP",e.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]},e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}}]),r}(zt),Zt=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"checkGenerateKeyParams",value:function(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}},{key:"checkNamedCurve",value:function(e){var t,r=x(this.namedCurves);try{for(r.s();!(t=r.n()).done;){if(t.value.toLowerCase()===e.toLowerCase())return}}catch(e){r.e(e)}finally{r.f()}throw new Ht("namedCurve: Must be one of ".concat(this.namedCurves.join(", ")))}}]),r}(Tt),$t=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="ECDSA",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(Zt),Xt=["secret","private","public"],Yt=function(){function e(){o(this,e)}return s(e,[{key:Symbol.toStringTag,get:function(){return"CryptoKey"}}],[{key:"create",value:function(e,t,r,n){var i=new this;return i.algorithm=e,i.type=t,i.extractable=r,i.usages=n,i}},{key:"isKeyType",value:function(e){return-1!==Xt.indexOf(e)}}]),e}(),Qt=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="ECDH",e.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof Yt))throw new TypeError("public: Is not a CryptoKey");if("public"!==e.public.type)throw new Ht("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new Ht("public: Is not ".concat(this.name," key"))}}]),r}(Zt),er=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="HMAC",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["sign","verify"],e}return s(r,[{key:"getDefaultLength",value:function(e){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":return 512;default:throw new Error("Unknown algorithm name '".concat(e,"'"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if("number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),r}(Tt),tr=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="PBKDF2",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["deriveBits","deriveKey"],e}return s(r,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),"number"!=typeof e.iterations)throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}},{key:"checkImportKey",value:function(e,t,n,i,a){if(b(v(r.prototype),"checkImportKey",this).call(this,e,t,n,i,a),i)throw new SyntaxError("extractable: Must be False")}}]),r}(Tt),rr=function(){function e(){o(this,e)}return s(e,[{key:Symbol.toStringTag,get:function(){return"Crypto"}}]),e}(),nr=function(){function e(){o(this,e),this.items={}}return s(e,[{key:"get",value:function(e){return this.items[e.toLowerCase()]||null}},{key:"set",value:function(e){this.items[e.name.toLowerCase()]=e}},{key:"removeAt",value:function(e){var t=this.get(e.toLowerCase());return t&&delete this.items[e],t}},{key:"has",value:function(e){return!!this.get(e)}},{key:"length",get:function(){return Object.keys(this.items).length}},{key:"algorithms",get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()}}]),e}(),ir=function(){function e(){o(this,e),this.providers=new nr}var t,r,i,u,c,l,f,v,p,y,g,m;return s(e,[{key:"digest",value:(m=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=l.length,r=new Array(t),n=0;n<t;n++)r[n]=l[n];return this.checkRequiredArguments(r,2,"digest"),i=r[0],a=r[1],o=this.prepareAlgorithm(i),u=E.toArrayBuffer(a),s=this.getProvider(o.name),e.next=8,s.digest(o,u);case 8:return c=e.sent,e.abrupt("return",c);case 10:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"generateKey",value:(g=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=l.length,r=new Array(t),n=0;n<t;n++)r[n]=l[n];return this.checkRequiredArguments(r,3,"generateKey"),i=r[0],a=r[1],o=r[2],u=this.prepareAlgorithm(i),s=this.getProvider(u.name),e.next=7,s.generateKey(h(h({},u),{},{name:s.name}),a,o);case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"sign",value:(y=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"sign"),i=r[0],a=r[1],o=r[2],this.checkCryptoKey(a),u=this.prepareAlgorithm(i),s=E.toArrayBuffer(o),c=this.getProvider(u.name),e.next=9,c.sign(h(h({},u),{},{name:c.name}),a,s);case 9:return l=e.sent,e.abrupt("return",l);case 11:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"verify",value:(p=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f,v,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,4,"verify"),i=r[0],a=r[1],o=r[2],u=r[3],this.checkCryptoKey(a),s=this.prepareAlgorithm(i),c=E.toArrayBuffer(u),l=E.toArrayBuffer(o),f=this.getProvider(s.name),e.next=10,f.verify(h(h({},s),{},{name:f.name}),a,l,c);case 10:return v=e.sent,e.abrupt("return",v);case 12:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"encrypt",value:(v=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"encrypt"),i=r[0],a=r[1],o=r[2],this.checkCryptoKey(a),u=this.prepareAlgorithm(i),s=E.toArrayBuffer(o),c=this.getProvider(u.name),e.next=9,c.encrypt(h(h({},u),{},{name:c.name}),a,s,{keyUsage:!0});case 9:return l=e.sent,e.abrupt("return",l);case 11:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"decrypt",value:(f=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=f.length,r=new Array(t),n=0;n<t;n++)r[n]=f[n];return this.checkRequiredArguments(r,3,"decrypt"),i=r[0],a=r[1],o=r[2],this.checkCryptoKey(a),u=this.prepareAlgorithm(i),s=E.toArrayBuffer(o),c=this.getProvider(u.name),e.next=9,c.decrypt(h(h({},u),{},{name:c.name}),a,s,{keyUsage:!0});case 9:return l=e.sent,e.abrupt("return",l);case 11:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"deriveBits",value:(l=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=l.length,r=new Array(t),n=0;n<t;n++)r[n]=l[n];return this.checkRequiredArguments(r,3,"deriveBits"),i=r[0],a=r[1],o=r[2],this.checkCryptoKey(a),u=this.prepareAlgorithm(i),s=this.getProvider(u.name),e.next=8,s.deriveBits(h(h({},u),{},{name:s.name}),a,o,{keyUsage:!0});case 8:return c=e.sent,e.abrupt("return",c);case 10:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"deriveKey",value:(c=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f,v,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=p.length,r=new Array(t),n=0;n<t;n++)r[n]=p[n];return this.checkRequiredArguments(r,5,"deriveKey"),i=r[0],a=r[1],o=r[2],u=r[3],s=r[4],c=this.prepareAlgorithm(o),this.getProvider(c.name).checkDerivedKeyParams(c),l=this.prepareAlgorithm(i),(f=this.getProvider(l.name)).checkCryptoKey(a,"deriveKey"),e.next=11,f.deriveBits(h(h({},l),{},{name:f.name}),a,o.length,{keyUsage:!1});case 11:return v=e.sent,e.abrupt("return",this.importKey("raw",v,o,u,s));case 13:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"exportKey",value:(u=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),n=0;n<t;n++)r[n]=s[n];return this.checkRequiredArguments(r,2,"exportKey"),i=r[0],a=r[1],this.checkCryptoKey(a),o=this.getProvider(a.algorithm.name),e.next=7,o.exportKey(i,a);case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"importKey",value:(i=a(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,u,s,c,l,f,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.length,r=new Array(t),n=0;n<t;n++)r[n]=v[n];if(this.checkRequiredArguments(r,5,"importKey"),i=r[0],a=r[1],o=r[2],u=r[3],s=r[4],c=this.prepareAlgorithm(o),l=this.getProvider(c.name),-1===["pkcs8","spki","raw"].indexOf(i)){e.next=10;break}return f=E.toArrayBuffer(a),e.abrupt("return",l.importKey(i,f,h(h({},c),{},{name:l.name}),u,s));case 10:if(a.kty){e.next=12;break}throw new TypeError("keyData: Is not JSON");case 12:return e.abrupt("return",l.importKey(i,a,h(h({},c),{},{name:l.name}),u,s));case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"wrapKey",value:(r=a(regeneratorRuntime.mark((function e(t,r,n,i){var a,o,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exportKey(t,r);case 2:return a=e.sent,"jwk"===t&&(o=JSON.stringify(a),a=N.FromUtf8String(o)),u=this.prepareAlgorithm(i),s=E.toArrayBuffer(a),c=this.getProvider(u.name),e.abrupt("return",c.encrypt(h(h({},u),{},{name:c.name}),n,s,{keyUsage:!1}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"unwrapKey",value:(t=a(regeneratorRuntime.mark((function e(t,r,n,i,a,o,u){var s,c,l,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.prepareAlgorithm(i),c=E.toArrayBuffer(r),l=this.getProvider(s.name),e.next=5,l.decrypt(h(h({},s),{},{name:l.name}),n,c,{keyUsage:!1});case 5:if(f=e.sent,"jwk"!==t){e.next=16;break}e.prev=7,f=JSON.parse(N.ToUtf8String(f)),e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(7),(v=new TypeError("wrappedKey: Is not a JSON")).internal=e.t0,v;case 16:return e.abrupt("return",this.importKey(t,f,a,o,u));case 17:case"end":return e.stop()}}),e,this,[[7,11]])}))),function(e,r,n,i,a,o,u){return t.apply(this,arguments)})},{key:"checkRequiredArguments",value:function(e,t,r){if(e.length!==t)throw new TypeError("Failed to execute '".concat(r,"' on 'SubtleCrypto': ").concat(t," arguments required, but only ").concat(e.length," present"))}},{key:"prepareAlgorithm",value:function(t){if("string"==typeof t)return{name:t};if(e.isHashedAlgorithm(t)){var r=h({},t);return r.hash=this.prepareAlgorithm(t.hash),r}return h({},t)}},{key:"getProvider",value:function(e){var t=this.providers.get(e);if(!t)throw new Ut("Unrecognized name");return t}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof Yt))throw new TypeError("Key is not of type 'CryptoKey'")}},{key:Symbol.toStringTag,get:function(){return"SubtleCrypto"}}],[{key:"isHashedAlgorithm",value:function(e){return!!(e&&"object"===n(e)&&"name"in e&&"hash"in e)}}]),e}(),ar=function e(t){o(this,e),t&&(this.value=t)};K([st({type:j.ObjectIdentifier})],ar.prototype,"value",void 0),ar=K([ut({type:D.Choice})],ar);var or=function e(t){o(this,e),Object.assign(this,t)};K([st({type:j.ObjectIdentifier})],or.prototype,"algorithm",void 0),K([st({type:j.Any,optional:!0})],or.prototype,"parameters",void 0);var ur=function e(){o(this,e),this.version=0,this.privateKeyAlgorithm=new or,this.privateKey=new ArrayBuffer(0)};K([st({type:j.Integer})],ur.prototype,"version",void 0),K([st({type:or})],ur.prototype,"privateKeyAlgorithm",void 0),K([st({type:j.OctetString})],ur.prototype,"privateKey",void 0),K([st({type:j.Any,optional:!0})],ur.prototype,"attributes",void 0);var sr=function e(){o(this,e),this.publicKeyAlgorithm=new or,this.publicKey=new ArrayBuffer(0)};K([st({type:or})],sr.prototype,"publicKeyAlgorithm",void 0),K([st({type:j.BitString})],sr.prototype,"publicKey",void 0);var cr={fromJSON:function(e){return N.FromBase64Url(e)},toJSON:function(e){return N.ToBase64Url(new Uint8Array(e))}},lr={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?Buffer.concat([Buffer.from([0]),Buffer.from(e)]):Buffer.from(e);return new ke({valueHex:new Uint8Array(t).buffer})}},hr=function e(){o(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)};K([st({type:j.Integer,converter:He})],hr.prototype,"version",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"n",converter:cr})],hr.prototype,"modulus",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"e",converter:cr})],hr.prototype,"publicExponent",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"d",converter:cr})],hr.prototype,"privateExponent",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"p",converter:cr})],hr.prototype,"prime1",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"q",converter:cr})],hr.prototype,"prime2",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"dp",converter:cr})],hr.prototype,"exponent1",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"dq",converter:cr})],hr.prototype,"exponent2",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"qi",converter:cr})],hr.prototype,"coefficient",void 0),K([st({type:j.Any,optional:!0})],hr.prototype,"otherPrimeInfos",void 0);var fr=function e(){o(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)};K([st({type:j.Integer,converter:lr}),Kt({name:"n",converter:cr})],fr.prototype,"modulus",void 0),K([st({type:j.Integer,converter:lr}),Kt({name:"e",converter:cr})],fr.prototype,"publicExponent",void 0);var vr=function(){function e(t){o(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return s(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Ot("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:N.ToBase64Url(e.buffer.slice(0,0+t)),y:N.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=N.FromBase64Url(e.x),r=N.FromBase64Url(e.y),n=Buffer.concat([new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r)]);return this.value=new Uint8Array(n).buffer,this}}]),e}();K([st({type:j.OctetString})],vr.prototype,"value",void 0),vr=K([ut({type:D.Choice})],vr);var pr=function(){function e(){o(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return s(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=N.FromBase64Url(e.d),"x"in e){var t=new vr;t.fromJSON(e),this.publicKey=ht.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=N.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new vr(this.publicKey).toJSON()),e}}]),e}();K([st({type:j.Integer,converter:He})],pr.prototype,"version",void 0),K([st({type:j.OctetString})],pr.prototype,"privateKey",void 0),K([st({context:0,type:j.Any,optional:!0})],pr.prototype,"parameters",void 0),K([st({context:1,type:j.BitString,optional:!0})],pr.prototype,"publicKey",void 0);var yr={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new ke({valueHex:r.buffer})}return new ke({valueHex:e})}},gr=function(){function e(){o(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}return s(e,[{key:"toWebCryptoSignature",value:function(e){e=this.getPointSize();var t=this.addPadding(e,E.toUint8Array(this.r)),r=this.addPadding(e,E.toUint8Array(this.s)),n=new Uint8Array(t.byteLength+r.byteLength);return n.set(t,0),n.set(r,t.length),n.buffer}},{key:"getPointSize",value:function(){switch(Math.max(this.r.byteLength,this.s.byteLength)){case 31:case 32:return 32;case 47:case 48:return 48;case 65:case 66:return 66}throw new Error("Unsupported EC point size")}},{key:"addPadding",value:function(e,t){var r=new Uint8Array(e),n=E.toUint8Array(t);return r.set(n,e-n.length),r}},{key:"removePadding",value:function(e){for(var t=E.toUint8Array(e),r=0;r<t.length;r++)if(t[r])return t.slice(r);return new Uint8Array(0)}}],[{key:"fromWebCryptoSignature",value:function(e){var t=E.toUint8Array(e),r=t.byteLength/2,n=new this;return n.r=n.removePadding(t.slice(0,r)),n.s=n.removePadding(t.slice(r,2*r)),n}}]),e}();function mr(e,t,r,i){var a,o=arguments.length,u=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"===("undefined"==typeof Reflect?"undefined":n(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(u=(o<3?a(u):o>3?a(t,r,u):a(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u}function dr(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))}K([st({type:j.Integer,converter:yr})],gr.prototype,"r",void 0),K([st({type:j.Integer,converter:yr})],gr.prototype,"s",void 0);var kr=function e(t){o(this,e),t&&(this.value=t)};mr([st({type:j.ObjectIdentifier})],kr.prototype,"value",void 0),kr=mr([ut({type:D.Choice})],kr);var wr=function e(t){o(this,e),Object.assign(this,t)};mr([st({type:j.ObjectIdentifier})],wr.prototype,"algorithm",void 0),mr([st({type:j.Any,optional:!0})],wr.prototype,"parameters",void 0);var br=function e(){o(this,e),this.version=0,this.privateKeyAlgorithm=new wr,this.privateKey=new ArrayBuffer(0)};mr([st({type:j.Integer})],br.prototype,"version",void 0),mr([st({type:wr})],br.prototype,"privateKeyAlgorithm",void 0),mr([st({type:j.OctetString})],br.prototype,"privateKey",void 0),mr([st({type:j.Any,optional:!0})],br.prototype,"attributes",void 0);var Br=function e(){o(this,e),this.publicKeyAlgorithm=new wr,this.publicKey=new ArrayBuffer(0)};mr([st({type:wr})],Br.prototype,"publicKeyAlgorithm",void 0),mr([st({type:j.BitString})],Br.prototype,"publicKey",void 0);var Ar,Sr={fromJSON:function(e){return N.FromBase64Url(e)},toJSON:function(e){return N.ToBase64Url(new Uint8Array(e))}};function xr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}!function(e){e.Unknown="Unknown",e.IE="Internet Explorer",e.Safari="Safari",e.Edge="Edge",e.Chrome="Chrome",e.Firefox="Firefox Mozilla",e.Mobile="Mobile"}(Ar||(Ar={}));var Cr={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?xr(new Uint8Array([0]),new Uint8Array(e)):new Uint8Array(e);return new ke({valueHex:new Uint8Array(t).buffer})}},Rr=function e(){o(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)};mr([st({type:j.Integer,converter:He})],Rr.prototype,"version",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"n",converter:Sr})],Rr.prototype,"modulus",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"e",converter:Sr})],Rr.prototype,"publicExponent",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"d",converter:Sr})],Rr.prototype,"privateExponent",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"p",converter:Sr})],Rr.prototype,"prime1",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"q",converter:Sr})],Rr.prototype,"prime2",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"dp",converter:Sr})],Rr.prototype,"exponent1",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"dq",converter:Sr})],Rr.prototype,"exponent2",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"qi",converter:Sr})],Rr.prototype,"coefficient",void 0),mr([st({type:j.Any,optional:!0})],Rr.prototype,"otherPrimeInfos",void 0);var Nr=function e(){o(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)};mr([st({type:j.Integer,converter:Cr}),Kt({name:"n",converter:Sr})],Nr.prototype,"modulus",void 0),mr([st({type:j.Integer,converter:Cr}),Kt({name:"e",converter:Sr})],Nr.prototype,"publicExponent",void 0);var Er=function(){function e(t){o(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return s(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Ot("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:N.ToBase64Url(e.buffer.slice(0,0+t)),y:N.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=N.FromBase64Url(e.x),r=N.FromBase64Url(e.y),n=xr(new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r));return this.value=new Uint8Array(n).buffer,this}}]),e}();mr([st({type:j.OctetString})],Er.prototype,"value",void 0),Er=mr([ut({type:D.Choice})],Er);var Kr=function(){function e(){o(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return s(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=N.FromBase64Url(e.d),"x"in e){var t=new Er;t.fromJSON(e),this.publicKey=ht.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=N.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new Er(this.publicKey).toJSON()),e}}]),e}();mr([st({type:j.Integer,converter:He})],Kr.prototype,"version",void 0),mr([st({type:j.OctetString})],Kr.prototype,"privateKey",void 0),mr([st({context:0,type:j.Any,optional:!0})],Kr.prototype,"parameters",void 0),mr([st({context:1,type:j.BitString,optional:!0})],Kr.prototype,"publicKey",void 0);var Or={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new ke({valueHex:r})}return new ke({valueHex:e})}},Ur=function e(){o(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)};mr([st({type:j.Integer,converter:Or})],Ur.prototype,"r",void 0),mr([st({type:j.Integer,converter:Or})],Ur.prototype,"s",void 0);var Lr=function(){function e(){o(this,e)}return s(e,null,[{key:"log",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log.apply(console,t)}}},{key:"error",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error.apply(console,t)}}},{key:"info",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.info.apply(console,t)}}},{key:"warn",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn.apply(console,t)}}},{key:"trace",value:function(){if(this.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.trace.apply(console,t)}}},{key:"enabled",get:function(){return"undefined"!=typeof self&&self.PV_WEBCRYPTO_LINER_LOG}}]),e}(),Hr=function(e){f(r,e);var t=w(r);function r(e,n,i,a){var u;return o(this,r),(u=t.call(this)).extractable=n,u.type=i,u.usages=a,u.algorithm=Object.assign({},e),u}return r}(Yt);function Pr(e,t){return e.name.toUpperCase()===t.toUpperCase()}var Ir=function(e){f(r,e);var t=w(r);function r(e,n,i,a){var u;return o(this,r),(u=t.call(this,e,n,"secret",i)).raw=a,u}return s(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:N.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return"A".concat(this.algorithm.length,"CBC");case"AES-CTR":return"A".concat(this.algorithm.length,"CTR");case"AES-GCM":return"A".concat(this.algorithm.length,"GCM");case"AES-ECB":return"A".concat(this.algorithm.length,"ECB");default:throw new Ut("Unsupported algorithm name")}}}]),r}(Hr),Tr=function(){function r(){o(this,r)}return s(r,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof Ir))throw new TypeError("key: Is not AesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new Ir(t,r,n,a));case 2:case"end":return i.stop()}}),i)})))}},{key:"encrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,E.toUint8Array(r),!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,E.toUint8Array(r),!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"exportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="jwk"===r.t0?3:"raw"===r.t0?4:5;break;case 3:return r.abrupt("return",t.toJSON());case 4:return r.abrupt("return",t.raw.buffer);case 5:throw new Ht("format: Must be 'jwk' or 'raw'");case 6:case"end":return r.stop()}}),r)})))}},{key:"importKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=It(t)?N.FromBase64Url(t.k):E.toArrayBuffer(t),e.t0=a.byteLength<<3,e.next=128===e.t0||192===e.t0||256===e.t0?4:5;break;case 4:return e.abrupt("break",6);case 5:throw new Ht("keyData: Is wrong key length");case 6:return o=new Ir({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))}},{key:"cipher",value:function(e,n,i,a){return dr(this,void 0,void 0,regeneratorRuntime.mark((function o(){var u,s,c,l,h,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=a?"encrypt":"decrypt",!Pr(e,r.AesCBC)){o.next=6;break}c=E.toUint8Array(e.iv),s=t.AES_CBC[u](i,n.raw,void 0,c),o.next=18;break;case 6:if(!Pr(e,r.AesGCM)){o.next=13;break}l=E.toUint8Array(e.iv),e.additionalData&&(h=E.toArrayBuffer(e.additionalData)),f=(e.tagLength||128)/8,s=t.AES_GCM[u](i,n.raw,l,h,f),o.next=18;break;case 13:if(!Pr(e,r.AesECB)){o.next=17;break}s=t.AES_ECB[u](i,n.raw,!0),o.next=18;break;case 17:throw new Ht("algorithm: Is not recognized");case 18:return o.abrupt("return",E.toArrayBuffer(s));case 19:case"end":return o.stop()}}),o)})))}}]),r}();Tr.AesCBC="AES-CBC",Tr.AesECB="AES-ECB",Tr.AesGCM="AES-GCM";var Dr=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Tr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Tr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Tr.checkCryptoKey(e)}}]),r}(jt),jr=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Tr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Tr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Tr.checkCryptoKey(e)}}]),r}(Vt),_r=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Tr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Tr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Tr.checkCryptoKey(e)}}]),r}(Jt),Vr=function(e){f(n,e);var r=w(n);function n(){return o(this,n),r.apply(this,arguments)}return s(n,[{key:"onEncrypt",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.AES_CTR(r.raw,E.toUint8Array(e.counter)).encrypt(E.toUint8Array(n)),i.abrupt("return",E.toArrayBuffer(a));case 2:case"end":return i.stop()}}),i)})))}},{key:"onDecrypt",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.AES_CTR(r.raw,E.toUint8Array(e.counter)).decrypt(E.toUint8Array(n)),i.abrupt("return",E.toArrayBuffer(a));case 2:case"end":return i.stop()}}),i)})))}},{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Tr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Tr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Tr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),Tr.checkCryptoKey(e)}}]),n}(_t),Jr=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Tr.checkCryptoKey(e)}}]),r}(Mt),Mr=function(e){f(r,e);var t=w(r);function r(e,n,i,a,u){var s;return o(this,r),(s=t.call(this,e,n,i,a)).data=u,s}return r}(Hr),Fr=function(){function t(){o(this,t)}return s(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof Mr))throw new TypeError("key: Is not RsaCryptoKey")}},{key:"generateKey",value:function(t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s,c,l,h,f=this;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a={name:"RSA-PSS",hash:"SHA-256",publicExponent:t.publicExponent,modulusLength:t.modulusLength},i.next=3,e.nativeSubtle.generateKey(a,!0,["sign","verify"]);case 3:return o=i.sent,u=new Ai,i.next=7,u.subtle.exportKey("pkcs8",o.privateKey);case 7:return s=i.sent,i.next=10,u.subtle.importKey("pkcs8",s,t,r,n.filter((function(e){return f.privateUsages.includes(e)})));case 10:return c=i.sent,i.next=13,u.subtle.exportKey("spki",o.publicKey);case 13:return l=i.sent,i.next=16,u.subtle.importKey("spki",l,t,!0,n.filter((function(e){return f.publicUsages.includes(e)})));case 16:return h=i.sent,i.abrupt("return",{privateKey:c,publicKey:h});case 18:case"end":return i.stop()}}),i)})))}},{key:"exportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="pkcs8"===r.t0?3:"spki"===r.t0?4:"jwk"===r.t0?5:6;break;case 3:return r.abrupt("return",this.exportPkcs8Key(t));case 4:return r.abrupt("return",this.exportSpkiKey(t));case 5:return r.abrupt("return",this.exportJwkKey(t));case 6:throw new Ht("format: Must be 'jwk', 'pkcs8' or 'spki'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e,a.next="pkcs8"===a.t0?3:"spki"===a.t0?5:"jwk"===a.t0?7:9;break;case 3:return o=this.importPkcs8Key(t),a.abrupt("break",10);case 5:return o=this.importSpkiKey(t),a.abrupt("break",10);case 7:return o=this.importJwkKey(t),a.abrupt("break",10);case 9:throw new Ht("format: Must be 'jwk', 'pkcs8' or 'spki'");case 10:return u=new Mr(Object.assign({publicExponent:1===o[1][1]?o[1].slice(1):o[1].slice(3),modulusLength:o[0].byteLength<<3},r),n,2===o.length?"public":"private",i,o),a.abrupt("return",u);case 12:case"end":return a.stop()}}),a,this)})))}},{key:"randomNonZeroValues",value:function(t){return(t=e.nativeCrypto.getRandomValues(t)).map((function(t){for(;!t;)t=e.nativeCrypto.getRandomValues(new Uint8Array(1))[0];return t}))}},{key:"exportPkcs8Key",value:function(e){var t=new br;return t.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",t.privateKeyAlgorithm.parameters=null,t.privateKey=ht.serialize(this.exportAsmKey(e.data)),ht.serialize(t)}},{key:"importPkcs8Key",value:function(e){var t=lt.parse(e,br),r=lt.parse(t.privateKey,Rr);return this.importAsmKey(r)}},{key:"importSpkiKey",value:function(e){var t=lt.parse(e,Br),r=lt.parse(t.publicKey,Nr);return this.importAsmKey(r)}},{key:"exportSpkiKey",value:function(e){var t=new Nr;t.modulus=e.data[0].buffer,t.publicExponent=1===e.data[1][1]?e.data[1].buffer.slice(1):e.data[1].buffer.slice(3);var r=new Br;return r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.publicKeyAlgorithm.parameters=null,r.publicKey=ht.serialize(t),ht.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Nt.fromJSON(e,{targetSchema:Rr}):Nt.fromJSON(e,{targetSchema:Nr}),this.importAsmKey(t)}},{key:"exportJwkKey",value:function(e){var t=this.exportAsmKey(e.data),r=Rt.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.kty="RSA",r.alg=this.getJwkAlgorithm(e.algorithm),r}},{key:"getJwkAlgorithm",value:function(e){switch(e.name.toUpperCase()){case"RSA-OAEP":var t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP".concat("1"!==t?"-".concat(t):"");case"RSASSA-PKCS1-V1_5":return"RS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSA-PSS":return"PS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSAES-PKCS1-V1_5":return"PS1";default:throw new Ht("algorithm: Is not recognized")}}},{key:"exportAsmKey",value:function(e){var t;if(e.length>2){var r=new Rr;r.privateExponent=e[2].buffer,r.prime1=e[3].buffer,r.prime2=e[4].buffer,r.exponent1=e[5].buffer,r.exponent2=e[6].buffer,r.coefficient=e[7].buffer,t=r}else t=new Nr;return t.modulus=e[0].buffer,t.publicExponent=1===e[1][1]?e[1].buffer.slice(1):e[1].buffer.slice(3),t}},{key:"importAsmKey",value:function(e){var t=new Uint8Array(4-e.publicExponent.byteLength),r=[new Uint8Array(e.modulus),xr(t,new Uint8Array(e.publicExponent))];return e instanceof Rr&&(r.push(new Uint8Array(e.privateExponent)),r.push(new Uint8Array(e.prime1)),r.push(new Uint8Array(e.prime2)),r.push(new Uint8Array(e.exponent1)),r.push(new Uint8Array(e.exponent2)),r.push(new Uint8Array(e.coefficient))),r}}]),t}();Fr.RsaSsa="RSASSA-PKCS1-v1_5",Fr.RsaPss="RSA-PSS",Fr.RsaOaep="RSA-OAEP",Fr.privateUsages=["sign","decrypt","unwrapKey"],Fr.publicUsages=["verify","encrypt","wrapKey"];var zr=function(){function e(){o(this,e)}return s(e,null,[{key:"getDigest",value:function(e){switch(e){case"SHA-1":return new t.Sha1;case"SHA-256":return new t.Sha256;case"SHA-512":return new t.Sha512;default:throw new Ut("keyAlgorithm.hash: Is not recognized")}}},{key:"digest",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.getDigest(e.name),i=n.process(E.toUint8Array(t)).finish().result,r.abrupt("return",E.toArrayBuffer(i));case 3:case"end":return r.stop()}}),r,this)})))}}]),e}(),Gr=function(e){f(n,e);var r=w(n);function n(){return o(this,n),r.apply(this,arguments)}return s(n,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Fr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Fr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Fr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),Fr.checkCryptoKey(e)}},{key:"cipher",value:function(e,r,n){var i,a=zr.getDigest(r.algorithm.hash.name);e.label&&(i=E.toUint8Array(e.label));var o,u=new t.RSA_OAEP(r.data,a,i),s=E.toUint8Array(n);return o="public"===r.type?u.encrypt(s):u.decrypt(s),E.toArrayBuffer(o)}}]),n}(Wt),qr=function(e){f(n,e);var r=w(n);function n(){return o(this,n),r.apply(this,arguments)}return s(n,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Fr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Fr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Fr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.RSA_PSS(r.data,zr.getDigest(r.algorithm.hash.name),e.saltLength),o=a.sign(E.toUint8Array(n)),i.abrupt("return",E.toArrayBuffer(o));case 3:case"end":return i.stop()}}),i)})))}},{key:"onVerify",value:function(e,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=new t.RSA_PSS(r.data,zr.getDigest(r.algorithm.hash.name),e.saltLength),a.prev=1,o.verify(E.toUint8Array(n),E.toUint8Array(i)),a.next=8;break;case 5:return a.prev=5,a.t0=a.catch(1),a.abrupt("return",!1);case 8:return a.abrupt("return",!0);case 9:case"end":return a.stop()}}),a,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),Fr.checkCryptoKey(e)}}]),n}(qt),Wr=function(e){f(n,e);var r=w(n);function n(){return o(this,n),r.apply(this,arguments)}return s(n,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Fr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Fr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Fr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new t.RSA_PKCS1_v1_5(r.data,zr.getDigest(r.algorithm.hash.name)),a=i.sign(E.toUint8Array(n)),e.abrupt("return",E.toArrayBuffer(a));case 3:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new t.RSA_PKCS1_v1_5(r.data,zr.getDigest(r.algorithm.hash.name)),e.prev=1,a.verify(E.toUint8Array(n),E.toUint8Array(i)),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),Fr.checkCryptoKey(e)}}]),n}(Gt),Zr=function(e){f(n,e);var r=w(n);function n(){var e;return o(this,n),(e=r.apply(this,arguments)).name="RSAES-PKCS1-v1_5",e.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]},e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return s(n,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Fr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=N.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"onDecrypt",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new t.RSA(r.data).decrypt(new t.BigNumber(E.toUint8Array(n))).result,a=r.algorithm.modulusLength>>3,n.byteLength===a){e.next=4;break}throw new Ot("Decryption error. Encrypted message size doesn't match to key length");case 4:if(o=0,!i[o++]&&2===i[o++]){e.next=7;break}throw new Ot("Decryption error");case 7:if(0!==i[o++]){e.next=9;break}return e.abrupt("break",10);case 9:if(o<i.length){e.next=7;break}case 10:if(!(o<11)){e.next=12;break}throw new Ot("Decryption error. PS is less than 8 octets.");case 12:if(o!==i.length){e.next=14;break}throw new Ot("Decryption error. There is no octet with hexadecimal value 0x00 to separate PS from M");case 14:return e.abrupt("return",i.buffer.slice(o));case 15:case"end":return e.stop()}}),e)})))}},{key:"onEncrypt",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a,o,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.algorithm.modulusLength>>3,!(n.byteLength>i-11)){e.next=3;break}throw new Ot("Message too long");case 3:return a=i-n.byteLength-3,o=Fr.randomNonZeroValues(new Uint8Array(a)),(u=new Uint8Array(i))[0]=0,u[1]=2,u.set(o,2),u[2+a]=0,u.set(new Uint8Array(n),3+a),s=new t.RSA(r.data).encrypt(new t.BigNumber(u)).result,e.abrupt("return",E.toArrayBuffer(s));case 13:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Fr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Fr.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i);case 2:return o=a.sent,a.abrupt("return",o);case 4:case"end":return a.stop()}}),a,this)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),Fr.checkCryptoKey(e)}},{key:"prepareSignData",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Ai,r.abrupt("return",n.subtle.digest(e.hash,t));case 2:case"end":return r.stop()}}),r)})))}}]),n}(Tt),$r={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10"};function Xr(e){var t=$r[e];if(!t)throw new Ht("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var Yr=function(e){f(r,e);var t=w(r);function r(e,n,i,a,u){var s;return o(this,r),(s=t.call(this,e,n,i,a)).data=u,s}return r}(Hr),Qr=function(){function e(){o(this,e)}return s(e,null,[{key:"checkLib",value:function(){if(void 0===r)throw new Ht("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"generateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u,s=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkLib(),i=this.initEcKey(e.namedCurve),(a=i.genKeyPair()).getPublic(),o=new Yr(Object.assign({},e),t,"private",r.filter((function(e){return~s.privateUsages.indexOf(e)})),a),u=new Yr(Object.assign({},e),!0,"public",r.filter((function(e){return~s.publicUsages.indexOf(e)})),a),n.abrupt("return",{privateKey:o,publicKey:u});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof Yr))throw new TypeError("key: Is not EcCryptoKey")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}},{key:"exportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="pkcs8"===r.t0?4:"spki"===r.t0?5:"jwk"===r.t0?6:"raw"===r.t0?7:8;break;case 4:return r.abrupt("return",this.exportPkcs8Key(t));case 5:return r.abrupt("return",this.exportSpkiKey(t));case 6:return r.abrupt("return",this.exportJwkKey(t));case 7:return r.abrupt("return",new Uint8Array(t.data.getPublic("der")).buffer);case 8:throw new Ht("format: Must be 'jwk', 'raw, 'pkcs8' or 'spki'");case 9:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.checkLib(),a.t0=e,a.next="pkcs8"===a.t0?4:"spki"===a.t0?6:"raw"===a.t0?8:"jwk"===a.t0?10:12;break;case 4:return o=this.importPkcs8Key(t,r.namedCurve),a.abrupt("break",13);case 6:return o=this.importSpkiKey(t,r.namedCurve),a.abrupt("break",13);case 8:return o=this.importEcKey(new Er(t),r.namedCurve),a.abrupt("break",13);case 10:return o=this.importJwkKey(t),a.abrupt("break",13);case 12:throw new Ht("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 13:return u=new Yr(Object.assign({},r),n,o.priv?"private":"public",i,o),a.abrupt("return",u);case 15:case"end":return a.stop()}}),a,this)})))}},{key:"getNamedCurve",value:function(e){var t=e.toUpperCase(),r="";if(["P-256","P-384","P-521"].indexOf(t)>-1)r=t.replace("-","").toLowerCase();else{if("K-256"!==t)throw new Ht("Unsupported named curve '".concat(e,"'"));r="secp256k1"}return r}},{key:"initEcKey",value:function(e){return r.ec(this.getNamedCurve(e))}},{key:"exportPkcs8Key",value:function(e){var t=new br;return t.privateKeyAlgorithm.algorithm=this.ASN_ALGORITHM,t.privateKeyAlgorithm.parameters=ht.serialize(new kr(Xr(e.algorithm.namedCurve))),t.privateKey=ht.serialize(this.exportEcKey(e)),ht.serialize(t)}},{key:"importPkcs8Key",value:function(e,t){var r=lt.parse(e,br),n=lt.parse(r.privateKey,Kr);return this.importEcKey(n,t)}},{key:"importSpkiKey",value:function(e,t){var r=lt.parse(e,Br),n=new Er(r.publicKey);return this.importEcKey(n,t)}},{key:"exportSpkiKey",value:function(e){var t=new Er(new Uint8Array(e.data.getPublic("der")).buffer),r=new Br;return r.publicKeyAlgorithm.algorithm=this.ASN_ALGORITHM,r.publicKeyAlgorithm.parameters=ht.serialize(new kr(Xr(e.algorithm.namedCurve))),r.publicKey=t.value,ht.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Nt.fromJSON(e,{targetSchema:Kr}):Nt.fromJSON(e,{targetSchema:Er}),this.importEcKey(t,e.crv)}},{key:"exportJwkKey",value:function(e){var t=this.exportEcKey(e),r=Rt.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.crv=e.algorithm.namedCurve,r.kty="EC",r}},{key:"exportEcKey",value:function(e){if("private"===e.type){var t=new Kr,r=new Uint8Array(e.data.getPrivate("der").toArray()),n=new Uint8Array(this.getPointSize(e.algorithm.namedCurve)-r.length);return t.privateKey=xr(n,r),t.publicKey=new Uint8Array(e.data.getPublic("der")),t}if(e.data.pub)return new Er(new Uint8Array(e.data.getPublic("der")).buffer);throw new Error("Cannot get private or public key")}},{key:"importEcKey",value:function(e,t){var r=this.initEcKey(t);return e instanceof Er?r.keyFromPublic(new Uint8Array(e.value)):r.keyFromPrivate(new Uint8Array(e.privateKey))}},{key:"getPointSize",value:function(e){switch(e){case"P-256":case"K-256":return 32;case"P-384":return 48;case"P-521":return 66}throw new Error("namedCurve: Is not recognized")}}]),e}();Qr.privateUsages=["sign","deriveKey","deriveBits"],Qr.publicUsages=["verify"],Qr.ASN_ALGORITHM="1.2.840.10045.2.1";var en=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Qr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Qr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Qr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onDeriveBits",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Qr.checkLib(),i=t.data.derive(e.public.data.getPublic()),a=new Uint8Array(i.toArray()),o=(o=a.length)>32?o>48?66:48:32,a.length<o&&(a=Qr.concat(new Uint8Array(o-a.length),a)),u=a.slice(0,r/8).buffer,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Qr.checkCryptoKey(e)}}]),r}(Qt);function tn(e){for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n++)r.push(t[n]);return r}function rn(e,t){e.length%2&&(e="0"+e);for(var r=new Uint8Array(e.length/2),n=0;n<e.length;n++){var i=e.slice(n,1+ ++n);r[(n-1)/2]=parseInt(i,16)}if(t){var a=r.length;a=a>32?a>48?66:48:32,r.length<a&&(r=Qr.concat(new Uint8Array(a-r.length),r))}return r}function nn(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n].toString(16);r+=i.length%2?"0"+i:i}if(t){var a=e.length;a=a>32?a>48?66:48:32,r.length/2<a&&(r=new Array(2*a-r.length+1).join("0")+r)}return r}var an=function(e){f(r,e);var t=w(r);function r(){return o(this,r),t.apply(this,arguments)}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Qr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Qr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Qr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Qr.checkLib(),i=new Ai,n.next=4,i.subtle.digest(e.hash,r);case 4:return o=n.sent,a=tn(o),n.next=8,t.data.sign(a);case 8:return u=n.sent,s=nn(u.r.toArray(),!0)+nn(u.s.toArray(),!0),n.abrupt("return",rn(s).buffer);case 11:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Qr.checkLib(),a=new Ai,o={r:new Uint8Array(r.slice(0,r.byteLength/2)),s:new Uint8Array(r.slice(r.byteLength/2))},i.next=5,a.subtle.digest(e.hash,n);case 5:return u=i.sent,s=tn(u),i.abrupt("return",t.data.verify(s,o));case 8:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),Qr.checkCryptoKey(e)}}]),r}($t),on=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="SHA-1",e.usages=[],e}return s(r,[{key:"onDigest",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",zr.digest(e,t));case 1:case"end":return r.stop()}}),r)})))}}]),r}(Tt),un=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="SHA-256",e}return r}(on),sn=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).name="SHA-512",e}return r}(on),cn=function(e){f(r,e);var t=w(r);function r(e,n,i,a){var u;return o(this,r),(u=t.call(this,e,n,"secret",i)).raw=a,u}return r}(Hr),ln=function(e){f(n,e);var r=w(n);function n(){return o(this,n),r.apply(this,arguments)}return s(n,[{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new cn(r,n,i,E.toUint8Array(t)));case 1:case"end":return e.stop()}}),e)})))}},{key:"onDeriveBits",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:o=E.toUint8Array(e.salt),u=r.raw,i.t0=e.hash.name.toUpperCase(),i.next="SHA-1"===i.t0?5:"SHA-256"===i.t0?7:"SHA-512"===i.t0?9:11;break;case 5:return a=t.Pbkdf2HmacSha1(u,o,e.iterations,n>>3),i.abrupt("break",12);case 7:return a=t.Pbkdf2HmacSha256(u,o,e.iterations,n>>3),i.abrupt("break",12);case 9:return a=t.Pbkdf2HmacSha512(u,o,e.iterations,n>>3),i.abrupt("break",12);case 11:throw new Ht("algorithm.hash: '".concat(e.hash.name,"' hash algorithm is not supported"));case 12:return i.abrupt("return",E.toArrayBuffer(a));case 13:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){if(b(v(n.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof cn))throw new TypeError("key: Is not PbkdfCryptoKey")}}]),n}(tr),hn=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24],fn=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11],vn=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7],pn={readUInt32BE:function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},writeUInt32BE:function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},ip:function(e,t,r,n){for(var i=0,a=0,o=6;o>=0;o-=2){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>>u+o&1}for(o=6;o>=0;o-=2){for(u=1;u<=25;u+=8)a<<=1,a|=t>>>u+o&1;for(u=1;u<=25;u+=8)a<<=1,a|=e>>>u+o&1}r[n+0]=i>>>0,r[n+1]=a>>>0},rip:function(e,t,r,n){for(var i=0,a=0,o=0;o<4;o++)for(var u=24;u>=0;u-=8)i<<=1,i|=t>>>u+o&1,i<<=1,i|=e>>>u+o&1;for(o=4;o<8;o++)for(u=24;u>=0;u-=8)a<<=1,a|=t>>>u+o&1,a<<=1,a|=e>>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},pc1:function(e,t,r,n){for(var i=0,a=0,o=7;o>=5;o--){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>u+o&1}for(u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(o=1;o<=3;o++){for(u=0;u<=24;u+=8)a<<=1,a|=t>>u+o&1;for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1}for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},r28shl:function(e,t){return e<<t&268435455|e>>>28-t},pc2:function(e,t,r,n){for(var i=0,a=0,o=hn.length>>>1,u=0;u<o;u++)i<<=1,i|=e>>>hn[u]&1;for(u=o;u<hn.length;u++)a<<=1,a|=t>>>hn[u]&1;r[n+0]=i>>>0,r[n+1]=a>>>0},expand:function(e,t,r){var n=0,i=0;n=(1&e)<<5|e>>>27;for(var a=23;a>=15;a-=4)n<<=6,n|=e>>>a&63;for(a=11;a>=3;a-=4)i|=e>>>a&63,i<<=6;i|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=i>>>0},substitute:function(e,t){for(var r=0,n=0;n<4;n++){r<<=4,r|=fn[64*n+(e>>>18-6*n&63)]}for(n=0;n<4;n++){r<<=4,r|=fn[256+64*n+(t>>>18-6*n&63)]}return r>>>0},permute:function(e){for(var t=0,r=0;r<vn.length;r++)t<<=1,t|=e>>>vn[r]&1;return t>>>0},padSplit:function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var i=[],a=0;a<t;a+=r)i.push(n.slice(a,a+r));return i.join(" ")}},yn=gn;function gn(e,t){if(!e)throw new Error(t||"Assertion failed")}function mn(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}gn.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var dn=mn;mn.prototype._init=function(){},mn.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},mn.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},mn.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},mn.prototype._updateEncrypt=function(e){var t=0,r=0,n=(this.bufferOff+e.length)/this.blockSize|0,i=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(i,r)));for(var a=e.length-(e.length-t)%this.blockSize;t<a;t+=this.blockSize)this._update(e,t,i,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return i},mn.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,i=new Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(i,r);return t+=this._buffer(e,t),i},mn.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},mn.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},mn.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},mn.prototype._unpad=function(e){return e},mn.prototype._finalDecrypt=function(){yn.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var kn="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},wn=/%[sdj%]/g;function bn(e){if(!Hn(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(Sn(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(e).replace(wn,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),o=n[r];r<i;o=n[++r])Un(o)||!Tn(o)?a+=" "+o:a+=" "+Sn(o);return a}var Bn,An={};function Sn(e,t){var r={seen:[],stylize:Cn};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),On(t)?r.showHidden=t:t&&zn(r,t),Pn(r.showHidden)&&(r.showHidden=!1),Pn(r.depth)&&(r.depth=2),Pn(r.colors)&&(r.colors=!1),Pn(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=xn),Rn(r,e,r.depth)}function xn(e,t){var r=Sn.styles[t];return r?"["+Sn.colors[r][0]+"m"+e+"["+Sn.colors[r][1]+"m":e}function Cn(e,t){return e}function Rn(e,t,r){if(e.customInspect&&t&&_n(t.inspect)&&t.inspect!==Sn&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return Hn(n)||(n=Rn(e,n,r)),n}var i=function(e,t){if(Pn(t))return e.stylize("undefined","undefined");if(Hn(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Ln(t))return e.stylize(""+t,"number");if(On(t))return e.stylize(""+t,"boolean");if(Un(t))return e.stylize("null","null")}(e,t);if(i)return i;var a=Object.keys(t),o=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),jn(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return Nn(t);if(0===a.length){if(_n(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(In(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Dn(t))return e.stylize(Date.prototype.toString.call(t),"date");if(jn(t))return Nn(t)}var s,c="",l=!1,h=["{","}"];(Kn(t)&&(l=!0,h=["[","]"]),_n(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return In(t)&&(c=" "+RegExp.prototype.toString.call(t)),Dn(t)&&(c=" "+Date.prototype.toUTCString.call(t)),jn(t)&&(c=" "+Nn(t)),0!==a.length||l&&0!=t.length?r<0?In(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),s=l?function(e,t,r,n,i){for(var a=[],o=0,u=t.length;o<u;++o)Gn(t,String(o))?a.push(En(e,t,r,n,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(En(e,t,r,n,i,!0))})),a}(e,t,r,o,a):a.map((function(n){return En(e,t,r,o,n,l)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(s,c,h)):h[0]+c+h[1]}function Nn(e){return"["+Error.prototype.toString.call(e)+"]"}function En(e,t,r,n,i,a){var o,u,s;if((s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?u=s.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):s.set&&(u=e.stylize("[Setter]","special")),Gn(n,i)||(o="["+i+"]"),u||(e.seen.indexOf(s.value)<0?(u=Un(r)?Rn(e,s.value,null):Rn(e,s.value,r-1)).indexOf("\n")>-1&&(u=a?u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")):u=e.stylize("[Circular]","special")),Pn(o)){if(a&&i.match(/^\d+$/))return u;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+u}function Kn(e){return Array.isArray(e)}function On(e){return"boolean"==typeof e}function Un(e){return null===e}function Ln(e){return"number"==typeof e}function Hn(e){return"string"==typeof e}function Pn(e){return void 0===e}function In(e){return Tn(e)&&"[object RegExp]"===Vn(e)}function Tn(e){return"object"===n(e)&&null!==e}function Dn(e){return Tn(e)&&"[object Date]"===Vn(e)}function jn(e){return Tn(e)&&("[object Error]"===Vn(e)||e instanceof Error)}function _n(e){return"function"==typeof e}function Vn(e){return Object.prototype.toString.call(e)}function Jn(e){return e<10?"0"+e.toString(10):e.toString(10)}Sn.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Sn.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Mn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Fn(){var e=new Date,t=[Jn(e.getHours()),Jn(e.getMinutes()),Jn(e.getSeconds())].join(":");return[e.getDate(),Mn[e.getMonth()],t].join(" ")}function zn(e,t){if(!t||!Tn(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function Gn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var qn={inherits:kn,_extend:zn,log:function(){console.log("%s - %s",Fn(),bn.apply(null,arguments))},isBuffer:function(e){return Buffer.isBuffer(e)},isPrimitive:function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===n(e)||void 0===e},isFunction:_n,isError:jn,isDate:Dn,isObject:Tn,isRegExp:In,isUndefined:Pn,isSymbol:function(e){return"symbol"===n(e)},isString:Hn,isNumber:Ln,isNullOrUndefined:function(e){return null==e},isNull:Un,isBoolean:On,isArray:Kn,inspect:Sn,deprecate:function e(t,r){if(Pn(global.process))return function(){return e(t,r).apply(this,arguments)};var n=!1;return function(){return n||(console.error(r),n=!0),t.apply(this,arguments)}},format:bn,debuglog:function(e){if(Pn(Bn)&&(Bn=""),e=e.toUpperCase(),!An[e])if(new RegExp("\\b"+e+"\\b","i").test(Bn)){An[e]=function(){var t=bn.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else An[e]=function(){};return An[e]}},Wn=O((function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}})),Zn=O((function(e){try{var t=qn;if("function"!=typeof t.inherits)throw"";e.exports=t.inherits}catch(t){e.exports=Wn}}));function $n(){this.tmp=new Array(2),this.keys=null}function Xn(e){dn.call(this,e);var t=new $n;this._desState=t,this.deriveKeys(t,e.key)}Zn(Xn,dn);var Yn=Xn;Xn.create=function(e){return new Xn(e)};var Qn=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];Xn.prototype.deriveKeys=function(e,t){e.keys=new Array(32),yn.equal(t.length,this.blockSize,"Invalid key length");var r=pn.readUInt32BE(t,0),n=pn.readUInt32BE(t,4);pn.pc1(r,n,e.tmp,0),r=e.tmp[0],n=e.tmp[1];for(var i=0;i<e.keys.length;i+=2){var a=Qn[i>>>1];r=pn.r28shl(r,a),n=pn.r28shl(n,a),pn.pc2(r,n,e.keys,i)}},Xn.prototype._update=function(e,t,r,n){var i=this._desState,a=pn.readUInt32BE(e,t),o=pn.readUInt32BE(e,t+4);pn.ip(a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],"encrypt"===this.type?this._encrypt(i,a,o,i.tmp,0):this._decrypt(i,a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],pn.writeUInt32BE(r,a,n),pn.writeUInt32BE(r,o,n+4)},Xn.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},Xn.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)yn.equal(e[r],t);return e.slice(0,e.length-t)},Xn.prototype._encrypt=function(e,t,r,n,i){for(var a=t,o=r,u=0;u<e.keys.length;u+=2){var s=e.keys[u],c=e.keys[u+1];pn.expand(o,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=pn.substitute(s,c),h=o;o=(a^pn.permute(l))>>>0,a=h}pn.rip(o,a,n,i)},Xn.prototype._decrypt=function(e,t,r,n,i){for(var a=r,o=t,u=e.keys.length-2;u>=0;u-=2){var s=e.keys[u],c=e.keys[u+1];pn.expand(a,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=pn.substitute(s,c),h=a;a=(o^pn.permute(l))>>>0,o=h}pn.rip(a,o,n,i)};var ei={};function ti(e){yn.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}var ri=function(e){function t(t){e.call(this,t),this._cbcInit()}Zn(t,e);for(var r=Object.keys(ei),n=0;n<r.length;n++){var i=r[n];t.prototype[i]=ei[i]}return t.create=function(e){return new t(e)},t};ei._cbcInit=function(){var e=new ti(this.options.iv);this._cbcState=e},ei._update=function(e,t,r,n){var i=this._cbcState,a=this.constructor.super_.prototype,o=i.iv;if("encrypt"===this.type){for(var u=0;u<this.blockSize;u++)o[u]^=e[t+u];a._update.call(this,o,0,r,n);for(u=0;u<this.blockSize;u++)o[u]=r[n+u]}else{a._update.call(this,e,t,r,n);for(u=0;u<this.blockSize;u++)r[n+u]^=o[u];for(u=0;u<this.blockSize;u++)o[u]=e[t+u]}};var ni={instantiate:ri};function ii(e,t){yn.equal(t.length,24,"Invalid key length");var r=t.slice(0,8),n=t.slice(8,16),i=t.slice(16,24);this.ciphers="encrypt"===e?[Yn.create({type:"encrypt",key:r}),Yn.create({type:"decrypt",key:n}),Yn.create({type:"encrypt",key:i})]:[Yn.create({type:"decrypt",key:i}),Yn.create({type:"encrypt",key:n}),Yn.create({type:"decrypt",key:r})]}function ai(e){dn.call(this,e);var t=new ii(this.type,this.options.key);this._edeState=t}Zn(ai,dn);var oi=ai;ai.create=function(e){return new ai(e)},ai.prototype._update=function(e,t,r,n){var i=this._edeState;i.ciphers[0]._update(e,t,r,n),i.ciphers[1]._update(r,n,r,n),i.ciphers[2]._update(r,n,r,n)},ai.prototype._pad=Yn.prototype._pad,ai.prototype._unpad=Yn.prototype._unpad;var ui=pn,si=dn,ci=Yn,li=ni,hi=oi,fi={utils:ui,Cipher:si,DES:ci,CBC:li,EDE:hi},vi=Object.freeze({__proto__:null,default:fi,__moduleExports:fi,utils:ui,Cipher:si,DES:ci,CBC:li,EDE:hi}),pi=function(e){f(r,e);var t=w(r);function r(e,n,i,a){var u;return o(this,r),(u=t.call(this,e,n,"secret",i)).raw=a,u}return s(r,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:N.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new Ut("Unsupported algorithm name")}}}]),r}(Hr),yi=function(){function t(){o(this,t)}return s(t,null,[{key:"checkLib",value:function(){if(void 0===vi)throw new Ht("Cannot implement DES mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/des.js' script to your project")}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof pi))throw new TypeError("key: Is not DesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkLib(),a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new pi(t,r,n,a));case 3:case"end":return i.stop()}}),i,this)})))}},{key:"exportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="jwk"===r.t0?4:"raw"===r.t0?5:6;break;case 4:return r.abrupt("return",t.toJSON());case 5:return r.abrupt("return",t.raw.buffer);case 6:throw new Ht("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkLib(),a=It(t)?N.FromBase64Url(t.k):E.toArrayBuffer(t),!("DES-CBC"===r.name&&8!==a.byteLength||"DES-EDE3-CBC"===r.name&&24!==a.byteLength)){e.next=4;break}throw new Ht("keyData: Is wrong key length");case 4:return o=new pi({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"cipher",value:function(e,t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.checkLib(),a=n?"encrypt":"decrypt",u=E.toUint8Array(e.iv),i.t0=e.name.toUpperCase(),i.next="DES-CBC"===i.t0?6:"DES-EDE3-CBC"===i.t0?8:10;break;case 6:return o=li.instantiate(ci).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 8:return o=li.instantiate(hi).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 10:throw new Ht("algorithm: Is not recognized");case 11:return s=o.update(new Uint8Array(r)).concat(o.final()),i.abrupt("return",new Uint8Array(s).buffer);case 13:case"end":return i.stop()}}),i,this)})))}}]),t}(),gi=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).keySizeBits=64,e.ivSize=8,e.name="DES-CBC",e}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",yi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",yi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),yi.checkCryptoKey(e)}}]),r}(Ft),mi=function(e){f(r,e);var t=w(r);function r(){var e;return o(this,r),(e=t.apply(this,arguments)).keySizeBits=192,e.ivSize=8,e.name="DES-EDE3-CBC",e}return s(r,[{key:"onGenerateKey",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",yi.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",yi.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return dr(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",yi.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,t){b(v(r.prototype),"checkCryptoKey",this).call(this,e,t),yi.checkCryptoKey(e)}}]),r}(Ft),di=function(e){f(r,e);var t=w(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"HMAC"},i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Uint8Array(0);return o(this,r),(e=t.call(this,n,i,"secret",a)).kty="oct",e.data=u,e}return s(r,[{key:"alg",get:function(){var e=this.algorithm.hash.name.toUpperCase();return"HS".concat(e.replace("SHA-",""))},set:function(e){}}]),r}(Hr);mr([Kt({name:"ext",type:at.Boolean,optional:!0})],di.prototype,"extractable",void 0),mr([Kt({name:"key_ops",type:at.String,repeated:!0,optional:!0})],di.prototype,"usages",void 0),mr([Kt({name:"k",converter:Sr})],di.prototype,"data",void 0),mr([Kt({type:at.String})],di.prototype,"kty",void 0),mr([Kt({type:at.String})],di.prototype,"alg",null);var ki,wi=function(r){f(i,r);var n=w(i);function i(){return o(this,i),n.apply(this,arguments)}return s(i,[{key:"onGenerateKey",value:function(t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.length||this.getDefaultLength(t.hash.name),o=e.nativeCrypto.getRandomValues(new Uint8Array(a>>3)),u=new di(t,r,n,o),i.abrupt("return",u);case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onSign",value:function(e,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.algorithm.hash.name.toUpperCase(),e.next="SHA-1"===e.t0?3:"SHA-256"===e.t0?5:"SHA-512"===e.t0?7:9;break;case 3:return i=t.HmacSha1,e.abrupt("break",10);case 5:return i=t.HmacSha256,e.abrupt("break",10);case 7:return i=t.HmacSha512,e.abrupt("break",10);case 9:throw new Ht("key.algorithm.hash: Is not recognized");case 10:return a=new i(r.data).process(E.toUint8Array(n)).finish().result,e.abrupt("return",E.toArrayBuffer(a));case 12:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return dr(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.onSign(e,t,n);case 2:return a=i.sent,i.abrupt("return",N.ToHex(a)===N.ToHex(r));case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return dr(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e.toLowerCase(),a.next="jwk"===a.t0?3:"raw"===a.t0?5:9;break;case 3:return o=Nt.fromJSON(t,{targetSchema:di}),a.abrupt("break",10);case 5:if(E.isBufferSource(t)){a.next=7;break}throw new TypeError("keyData: Is not ArrayBuffer or ArrayBufferView");case 7:return o=new di(r,n,i,E.toUint8Array(t)),a.abrupt("break",10);case 9:throw new Ht("format: Must be 'jwk' or 'raw'");case 10:return o.algorithm={hash:{name:r.hash.name},name:this.name,length:o.data.length<<3},o.extractable=n,o.usages=i,a.abrupt("return",o);case 14:case"end":return a.stop()}}),a,this)})))}},{key:"onExportKey",value:function(e,t){return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.toLowerCase(),r.next="jwk"===r.t0?3:"raw"===r.t0?5:6;break;case 3:return n=Rt.toJSON(t),r.abrupt("return",n);case 5:return r.abrupt("return",new Uint8Array(t.data).buffer);case 6:throw new Ht("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r)})))}},{key:"checkCryptoKey",value:function(e,t){if(b(v(i.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof di))throw new TypeError("key: Is not HMAC CryptoKey")}}]),i}(er),bi=function(e){f(r,e);var t=w(r);function r(e,n,i,a,u){var s;return o(this,r),s=t.call(this,e,n,i,a),ki.set(d(s),void 0),function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");t.set(e,r)}(d(s),ki,u),s}return s(r,[{key:"getNative",value:function(){return function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(this,ki)}}]),r}(Hr);ki=new WeakMap;var Bi=function(t){f(i,t);var r=w(i);function i(){var e;return o(this,i),(e=r.call(this)).browserInfo=function(){var e={name:Ar.Unknown,version:"0"};if("undefined"==typeof self)return e;var t,r=self.navigator.userAgent;return(t=/edge\/([\d\.]+)/i.exec(r))?(e.name=Ar.Edge,e.version=t[1]):/msie/i.test(r)?(e.name=Ar.IE,e.version=/msie ([\d\.]+)/i.exec(r)[1]):/Trident/i.test(r)?(e.name=Ar.IE,e.version=/rv:([\d\.]+)/i.exec(r)[1]):/chrome/i.test(r)?(e.name=Ar.Chrome,e.version=/chrome\/([\d\.]+)/i.exec(r)[1]):/firefox/i.test(r)?(e.name=Ar.Firefox,e.version=/firefox\/([\d\.]+)/i.exec(r)[1]):/mobile/i.test(r)?(e.name=Ar.Mobile,e.version=/mobile\/([\w]+)/i.exec(r)[1]):/safari/i.test(r)&&(e.name=Ar.Safari,e.version=/version\/([\d\.]+)/i.exec(r)[1]),e}(),e.providers.set(new Dr),e.providers.set(new Vr),e.providers.set(new jr),e.providers.set(new _r),e.providers.set(new Jr),e.providers.set(new gi),e.providers.set(new mi),e.providers.set(new Wr),e.providers.set(new qr),e.providers.set(new Gr),e.providers.set(new Zr),e.providers.set(new an),e.providers.set(new en),e.providers.set(new on),e.providers.set(new un),e.providers.set(new sn),e.providers.set(new ln),e.providers.set(new wi),e}return s(i,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["digest"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"importKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fixFirefoxEcImportPkcs8(t),e.abrupt("return",this.wrapNative.apply(this,["importKey"].concat(t)));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"exportKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fixFirefoxEcExportPkcs8(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return e.next=6,this.wrapNative.apply(this,["exportKey"].concat(t));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"generateKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["generateKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"sign",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["sign"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["verify"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["encrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"decrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["decrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["wrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"unwrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["unwrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveBits"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return dr(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapNative",value:function(t){for(var r=this,a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];var s=function(e){return b(v(i.prototype),e,r)};return dr(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,u,c,l,h,f,v,p,y,g,m,d,k,w,b;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(~["generateKey","unwrapKey","deriveKey","importKey"].indexOf(t)&&this.fixAlgorithmName(o),r.prev=1,"digest"===t&&o.some((function(e){return e instanceof Hr}))){r.next=9;break}return a=this.fixNativeArguments(t,o),Lr.info("Call native '".concat(t,"' method"),a),r.next=7,e.nativeSubtle[t].apply(e.nativeSubtle,a);case 7:return u=r.sent,r.abrupt("return",this.fixNativeResult(t,o,u));case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(1),Lr.warn("Error on native '".concat(t,"' calling. ").concat(r.t0.message),r.t0);case 14:if("wrapKey"!==t){r.next=30;break}return r.prev=15,Lr.info("Trying to wrap key by using native functions",o),r.next=19,this.exportKey(o[0],o[1]);case 19:return c=r.sent,l="jwk"===o[0]?N.FromUtf8String(JSON.stringify(c)):c,r.next=23,this.encrypt(o[3],o[2],l);case 23:return h=r.sent,r.abrupt("return",h);case 27:r.prev=27,r.t1=r.catch(15),Lr.warn("Cannot wrap key by native functions. ".concat(r.t1.message),r.t1);case 30:if("unwrapKey"!==t){r.next=46;break}return r.prev=31,Lr.info("Trying to unwrap key by using native functions",o),r.next=35,this.decrypt(o[3],o[2],o[1]);case 35:return f=r.sent,v="jwk"===o[0]?JSON.parse(N.ToUtf8String(f)):f,r.next=39,this.importKey(o[0],v,o[4],o[5],o[6]);case 39:return p=r.sent,r.abrupt("return",p);case 43:r.prev=43,r.t2=r.catch(31),Lr.warn("Cannot unwrap key by native functions. ".concat(r.t2.message),r.t2);case 46:if("deriveKey"!==t){r.next=61;break}return r.prev=47,Lr.info("Trying to derive key by using native functions",o),r.next=51,this.deriveBits(o[0],o[1],o[2].length);case 51:return y=r.sent,r.next=54,this.importKey("raw",y,o[2],o[3],o[4]);case 54:return g=r.sent,r.abrupt("return",g);case 58:r.prev=58,r.t3=r.catch(47),Lr.warn("Cannot derive key by native functions. ".concat(r.t3.message),r.t3);case 61:if("deriveBits"!==t&&"deriveKey"!==t){r.next=81;break}m=x(o),r.prev=63,m.s();case 65:if((d=m.n()).done){r.next=73;break}if("object"!==n(k=d.value)||!k.public||!i.isAnotherKey(k.public)){r.next=71;break}return r.next=70,this.castKey(k.public);case 70:k.public=r.sent;case 71:r.next=65;break;case 73:r.next=78;break;case 75:r.prev=75,r.t4=r.catch(63),m.e(r.t4);case 78:return r.prev=78,m.f(),r.finish(78);case 81:w=0;case 82:if(!(w<o.length)){r.next=91;break}if(b=o[w],!i.isAnotherKey(b)){r.next=88;break}return r.next=87,this.castKey(b);case 87:o[w]=r.sent;case 88:w++,r.next=82;break;case 91:return r.abrupt("return",s(t).apply(this,o));case 92:case"end":return r.stop()}}),r,this,[[1,11],[15,27],[31,43],[47,58],[63,75,78,81]])})))}},{key:"fixNativeArguments",value:function(e,t){var r,n,i,a,o,u,s,c,l=B(t);if("importKey"===e&&(this.browserInfo.name!==Ar.IE||"jwk"!==(null===(n=null===(r=l[0])||void 0===r?void 0:r.toLowerCase)||void 0===n?void 0:n.call(r))||E.isBufferSource(l[1])||(l[1]=N.FromUtf8String(JSON.stringify(l[1])))),this.browserInfo.name===Ar.IE&&t[1]instanceof bi)switch(e){case"sign":case"verify":case"encrypt":case"decrypt":l[0]=Object.assign(Object.assign({},this.prepareAlgorithm(l[0])),{hash:null===(o=null===(a=null===(i=l[1])||void 0===i?void 0:i.algorithm)||void 0===a?void 0:a.hash)||void 0===o?void 0:o.name});break;case"wrapKey":case"unwrapKey":l[4]=Object.assign(Object.assign({},this.prepareAlgorithm(l[4])),{hash:null===(c=null===(s=null===(u=l[3])||void 0===u?void 0:u.algorithm)||void 0===s?void 0:s.hash)||void 0===c?void 0:c.name})}for(var h=0;h<l.length;h++){var f=l[h];f instanceof bi&&(l[h]=f.getNative())}return l}},{key:"fixNativeResult",value:function(e,t,r){var n,i;if(this.browserInfo.name===Ar.IE){if("exportKey"===e&&"jwk"===(null===(i=null===(n=t[0])||void 0===n?void 0:n.toLowerCase)||void 0===i?void 0:i.call(n))&&r instanceof ArrayBuffer)return JSON.parse(N.ToUtf8String(r));if("privateKey"in r){var a=["sign","decrypt","unwrapKey","deriveKey","deriveBits"],o=["verify","encrypt","wrapKey"];return{privateKey:this.wrapNativeKey(r.privateKey,t[0],t[1],t[2].filter((function(e){return a.includes(e)}))),publicKey:this.wrapNativeKey(r.publicKey,t[0],t[1],t[2].filter((function(e){return o.includes(e)})))}}if("extractable"in r){var u,s;switch(e){case"importKey":u=t[2],s=t[4];break;case"unwrapKey":u=t[4],s=t[6];break;case"generateKey":u=t[0],s=t[2];break;default:throw new Ht("Cannot wrap native key. Unsupported method in use")}return this.wrapNativeKey(r,u,r.extractable,s)}}return r}},{key:"wrapNativeKey",value:function(e,t,r,n){if(this.browserInfo.name===Ar.IE){var i=["RSASSA-PKCS1-v1_5","RSA-PSS","RSA-OAEP","AES-CBC","AES-CTR","AES-KW","HMAC"],a=i.map((function(e){return e.toLowerCase()})).indexOf(e.algorithm.name.toLowerCase());if(-1!==a){var o=this.prepareAlgorithm(t),u=Object.assign(Object.assign({},e.algorithm),{name:i[a]});return ir.isHashedAlgorithm(o)&&(u.hash={name:o.hash.name.toUpperCase()}),Lr.info("Wrapping ".concat(i[a]," crypto key to WrappedNativeCryptoKey")),new bi(u,r,e.type,n,e)}}return e}},{key:"castKey",value:function(e){return dr(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Lr.info("Cast native CryptoKey to linter key.",e),e.extractable){t.next=3;break}throw new Error("Cannot cast unextractable crypto key");case 3:return r=this.getProvider(e.algorithm.name),t.next=6,this.exportKey("jwk",e);case 6:return n=t.sent,t.abrupt("return",r.importKey("jwk",n,e.algorithm,!0,e.usages));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"fixAlgorithmName",value:function(e){if(this.browserInfo.name===Ar.Edge)for(var t=0;t<e.length;t++){var r=e[0];if("string"==typeof r){var i,a=x(this.providers.algorithms);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.toLowerCase()===r.toLowerCase()){e[t]=o;break}}}catch(e){a.e(e)}finally{a.f()}}else if("object"===n(r)&&"string"==typeof r.name){var u,s=x(this.providers.algorithms);try{for(s.s();!(u=s.n()).done;){var c=u.value;c.toLowerCase()===r.name.toLowerCase()&&(r.name=c),("string"==typeof r.hash&&c.toLowerCase()===r.hash.toLowerCase()||"object"===n(r.hash)&&"string"==typeof r.hash.name&&c.toLowerCase()===r.hash.name.toLowerCase())&&(r.hash={name:c})}}catch(e){s.e(e)}finally{s.f()}}}}},{key:"fixFirefoxEcImportPkcs8",value:function(e){var t=this.prepareAlgorithm(e[2]),r=t.name.toUpperCase();if(this.browserInfo.name===Ar.Firefox&&"pkcs8"===e[0]&&~["ECDSA","ECDH"].indexOf(r)&&~["P-256","P-384","P-521"].indexOf(t.namedCurve)){if(!E.isBufferSource(e[1]))throw new TypeError("data: Is not ArrayBuffer or ArrayBufferView");var n=E.toArrayBuffer(e[1]),i=lt.parse(n,br),a=lt.parse(i.privateKey,Kr),o=Rt.toJSON(a);o.ext=!0,o.key_ops=e[4],o.crv=t.namedCurve,o.kty="EC",e[0]="jwk",e[1]=o}}},{key:"fixFirefoxEcExportPkcs8",value:function(e){return dr(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.browserInfo.name!==Ar.Firefox||"pkcs8"!==e[0]||!~["ECDSA","ECDH"].indexOf(e[1].algorithm.name)||!~["P-256","P-384","P-521"].indexOf(e[1].algorithm.namedCurve)){t.next=11;break}return t.next=4,this.exportKey("jwk",e[1]);case 4:return r=t.sent,n=Nt.fromJSON(r,{targetSchema:Kr}),(i=new br).privateKeyAlgorithm.algorithm=Qr.ASN_ALGORITHM,i.privateKeyAlgorithm.parameters=ht.serialize(new kr(Xr(e[1].algorithm.namedCurve))),i.privateKey=ht.serialize(n),t.abrupt("return",ht.serialize(i));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),Lr.error(t.t0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})))}}],[{key:"isAnotherKey",value:function(e){return"object"===n(e)&&"string"==typeof e.type&&"boolean"==typeof e.extractable&&"object"===n(e.algorithm)&&!(e instanceof Hr)}}]),i}(ir);Bi.methods=["digest","importKey","exportKey","sign","verify","generateKey","encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"];var Ai=function(t){f(n,t);var r=w(n);function n(){var e;return o(this,n),(e=r.apply(this,arguments)).subtle=new Bi,e}return s(n,[{key:"getRandomValues",value:function(t){return e.nativeCrypto.getRandomValues(t)}},{key:"nativeCrypto",get:function(){return e.nativeCrypto}}]),n}(rr);function Si(e,t){var r=e[t];e[t]=function(){var n=arguments;return new Promise((function(i,a){var o=r.apply(e,n);o.oncomplete=function(e){i(e.target.result)},o.onerror=function(e){a("Error on running '".concat(t,"' function"))}}))}}"undefined"!=typeof self&&self.msCrypto&&(Si(e.nativeSubtle,"generateKey"),Si(e.nativeSubtle,"digest"),Si(e.nativeSubtle,"sign"),Si(e.nativeSubtle,"verify"),Si(e.nativeSubtle,"encrypt"),Si(e.nativeSubtle,"decrypt"),Si(e.nativeSubtle,"importKey"),Si(e.nativeSubtle,"exportKey"),Si(e.nativeSubtle,"wrapKey"),Si(e.nativeSubtle,"unwrapKey"),Si(e.nativeSubtle,"deriveKey"),Si(e.nativeSubtle,"deriveBits")),Math.imul||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0});var xi=self;e.nativeCrypto&&Object.freeze(e.nativeCrypto.getRandomValues);try{delete self.crypto,xi.crypto=new Ai,Object.freeze(xi.crypto)}catch(e){Lr.error(e)}var Ci=xi.crypto;return e.Crypto=Ai,e.CryptoKey=Hr,e.crypto=Ci,e.setCrypto=function(t){e.nativeCrypto=t,e.nativeSubtle=t.subtle},e}({},self.asmCrypto,self.elliptic);
